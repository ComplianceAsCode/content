policy: 'ANSSI-BP-028'
title: 'Configuration Recommendations of a GNU/Linux System'
id: anssi
version: '2.0'
source: 
    https://cyber.gouv.fr/sites/default/files/document/linux_configuration-en-v2.pdf

levels:
    - id: minimal
    - id: intermediary
      inherits_from:
          - minimal
    - id: enhanced
      inherits_from:
          - intermediary
    - id: high
      inherits_from:
          - enhanced

reference_type: anssi

controls:
    - id: R1
      title: Hardware Support
      levels:
          - enhanced
      description: >-
          It is recommended to apply the configuration recommendations for Hardware
          support
          mentioned in ANSSI DAT-24.
      notes: >-
          This requirement can be checked, but remediation requires manual reinstall
          of the OS.
          The content automation cannot really configure the BIOS, but can in some
          cases,
          check settings that are visible to the OS. Like for example the NX/DX setting.
      status: automated
#  From ANSSI DAT-24
#  R1 and R2 Prefer 64 bit OS
      rules: []
    - id: R2
      title: Hardware configuration
      levels:
          - intermediary
      description: >-
          It is recommended to apply the configuration recommendations for BIOS/UEFI
          mentioned in
          ANSSI DAT-24.
      notes: >-
          Configurations recommended for this requirement are to be performed at the
          BIOS level.
      rules: []
      status: manual

    # From ANSSI DAT-24
    # R11 Password protect the BIOS
    # R12 Deactivate peripherals not needed
    # R13 The boot order list should give highest preference to component on which final OS is installed
    # R14 Enable NX/XD bit
    # - bios_enable_execution_restrictions  # Doesn't have check
    # R15 Disable VT-x/AMD-V functionality
    # R16 Enable IOMMU
    - id: R3
      title: UEFI Secure boot activation
      levels:
          - intermediary
      description: >-
          It is recommended to apply UEFI Secure Boot configuration of the distribution.
      notes: >-
          Secure Boot needs to be enabled in the UEFI Setup program.
          Enabling Secure Boot can't be accomplished from the operating system.
          Also, OVAL doesn't provide any reliable ways to detect the Secure Boot status.
          Therefore, we will not provide any rules to automate this requirement.
          We recommend checking the Secure Boot status using the `mokutil --sb-state`
          or `bootctl status`
          commands.
      rules: []
      status: manual

    - id: R4
      title: Replacing of preloaded keys
      levels:
          - high
      description: >-
          It is recommended to replace the UEFI preloaded keys with new keys used
          to sign;
          the bootloader and Linux kernel, or; the image of the Linux kernel in EFI
          format.
      notes: >-
          This requirement is not generally automatable. The Machine Owner Key (MOK)
          could
          be used to add keys to the Secure Boot db key database but manual interaction
          is
          required to navigate the UEFI console and input the key password.
          On systems where MOK utility is not supported, one will need to access the
          UEFI
          firmware interface to add new keys.
          We have no automation support for UEFI interfaces and the steps for each
          hardware
          manufacturer can vary.
      rules: []
      status: manual

    - id: R5
      title: Boot loader password
      levels:
          - intermediary
      description: >-
          A password protecting the boot loader must exist.
          This password must prevent any user from changing their configuration options.
      status: automated
      rules: []
    - id: R6
      title: Protecting kernel command line parameters
      levels:
          - high
      description: >-
          It is recommended that UEFI Secure Boot is used to protect the Linux Kernel
          command line parameters during boot.
      notes: >-
          To protect the Linux Kernel command line one needs to create an Unified
          Kernel Image and use
          it with the UEFI Secure Boot mechanism.
          To check if the Kernel image contains the kernel command one needs to inspect
          the binary, on
          the command line one can use the objdump command. But unfortunately OVAL
          is not able to
          inspect kernel images.
          Also, it is not trivial to automate creation of such image or configuration
          of the
          Secure Boot mechanism.
      rules: []
      status: manual

    - id: R7
      title: IOMMU Configuration Guidelines
      levels:
          - enhanced
      description: >-
          The iommu = force directive must be added to the list of kernel parameters
          during startup in addition to those already present in the configuration
          files of the bootloader (/boot/grub/menu.lst or /etc/default/grub).
      status: automated
      rules: []
    - id: R8
      title: Memory configuration options
      levels:
          - intermediary
      status: automated
      rules:
          # l1tf=full,force to enable countermeasure for L1 Terminal Fault vulnerability, or
          # l1tf=off to maximize performance, when system is not a hypervisor or VMs are trusted
          - var_l1tf_options=full_force

          # page_poison=on: activate the poisoning of the pages of the page allocator (buddy allocator)
          - var_slub_debug_options=FZP

          # spec_store_bypass_disable=seccomp: force the system to use the default countermeasure
          # (on an x86 system supporting seccomp) for the Specter v4 (Speculative Store Bypass) vulnerability
          - var_spec_store_bypass_disable_options=seccomp

          # spectre_v2=on: force the system to use a countermeasure for the Specter v2 (Branch Target Injection) vulnerability.
          - var_mds_options=full_nosmt

          # mce=0: force a kernel panic on uncorrected errors reported by Machine Check support.
          - var_rng_core_default_quality=500

          # Forbidden to map memory in low addresses (0)
          # vm.mmap_min_addr = 65536
    - id: R9
      title: Kernel configuration options
      levels:
          - intermediary
      status: automated
      rules:
          # Restrict access to the dmesg buffer (equivalent to
          # CONFIG_SECURITY_DMESG_RESTRICT=y)
          - sysctl_kernel_kptr_restrict_value=2

          # Explicitly specify the process id space supported by the kernel,
          # 65536 being an example value
          # kernel.pid_max=65536
    - id: R10
      title: Disabling the loading of kernel modules
      levels:
          - enhanced
      description: >-
          The loading of the kernel modules can be blocked by the activation of the
          sysctl kernel.modules_disabled:
          Prohibition of loading modules (except those already loaded to this point)
          kernel.modules_disabled = 1
      status: automated
      rules: []
    - id: R11
      title: Yama module sysctl configuration
      levels:
          - intermediary
      description: >-
          It is recommended to load the Yama security module at startup (by example
          passing the security = yama argument to the kernel) and configure the
          sysctl kernel.yama.ptrace_scope to a value of at least 1.
      status: automated
      rules: []
    - id: R12
      title: IPv4 configuration options
      levels:
          - intermediary
      status: automated
      rules:
          # Mitigation of the dispersion effect of the kernel JIT at the cost of a
          # compromise on  the associated performance.
          # net.core.bpf_jit_harden=2
          - sysctl_net_ipv4_conf_all_accept_redirects_value=disabled
          - sysctl_net_ipv4_conf_default_accept_redirects_value=disabled
          - sysctl_net_ipv4_conf_all_shared_media_value=disabled

          - sysctl_net_ipv4_conf_default_shared_media_value=disabled

          # Deny the source routing header information supplied by the
          # packet to determine its route.
          # net.ipv4.conf.all.accept_source_route = 0
          - sysctl_net_ipv4_conf_all_arp_ignore_value=2

          # Refuse the routing of packets whose source or destination address is that
          # of the local loopback.
          # net.ipv4.conf.all.route_localnet=0
    - id: R13
      title: Disabling IPv6
      levels:
          - intermediary
      notes: >-
          When IPv6 is not in use, disable it, otherwise secure the IPv6 stack.
          This control hardens the IPv6 stack, to disable it use the related rules
          instead.
      status: automated
#  Disable support for "router solicitations"
#  net.ipv6.conf.all.router_solicitations = 0
#  net.ipv6.conf.default.router_solicitations = 0
      rules: []
      related_rules:
          # Rules to select when disabling the IPv6 stack.
          - sysctl_net_ipv6_conf_all_disable_ipv6
          - sysctl_net_ipv6_conf_default_disable_ipv6

    - id: R14
      title: File system configuration options
      levels:
          - intermediary
      notes: >-
          The rule for the /proc file system is not implemented
      status: automated
#  Disable coredump creation for setuid executables
      rules: []
    - id: R15
      title: Compile options for memory management
      levels:
          - high
      status: automated
      notes: >-
          The special case of direct access to physical memory is not handled.
      rules:
          - kernel_config_strict_kernel_rwx
          - kernel_config_debug_wx
          - kernel_config_debug_fs
          - kernel_config_stackprotector
          - kernel_config_stackprotector_strong
          - kernel_config_sched_stack_end_check
          - kernel_config_hardened_usercopy
          - kernel_config_vmap_stack
          - kernel_config_fortify_source
          - kernel_config_acpi_custom_method
          - kernel_config_proc_kcore
          - kernel_config_compat_vdso
          - kernel_config_security_dmesg_restrict
          - kernel_config_legacy_vsyscall_none
          - kernel_config_legacy_vsyscall_emulate
          - kernel_config_legacy_vsyscall_xonly
          - kernel_config_x86_vsyscall_emulation

    - id: R16
      title: Compile options for kernel data structures
      levels:
          - high
      status: automated
      rules:
          - kernel_config_debug_credentials
          - kernel_config_debug_notifiers
          - kernel_config_debug_list
          - kernel_config_debug_sg
          - kernel_config_bug_on_data_corruption

    - id: R17
      title: Compile options for the memory allocator
      levels:
          - high
      status: automated
      rules:
          - kernel_config_slab_freelist_random
          - kernel_config_slab_freelist_hardened
          - kernel_config_slab_merge_default
          - kernel_config_slub_debug
          - kernel_config_page_poisoning
          - kernel_config_compat_brk

    - id: R18
      title: Compile options for the management of kernel module
      levels:
          - high
      status: automated
      rules:
          - kernel_config_strict_module_rwx
          - kernel_config_module_sig
          - kernel_config_module_sig_force
          - kernel_config_module_sig_all
          - kernel_config_module_sig_sha512
          - kernel_config_module_sig_hash
          - kernel_config_module_sig_key

    - id: R19
      title: Compile options for abnormal situations
      levels:
          - high
      status: automated
      rules:
          - kernel_config_bug
          - kernel_config_panic_on_oops
          - kernel_config_panic_timeout

    - id: R20
      title: Compile options for kernel security functions
      levels:
          - high
      status: automated
      rules:
          - kernel_config_seccomp
          - kernel_config_seccomp_filter
          - kernel_config_security
          - kernel_config_security_yama
    - id: R21
      title: Compile options for the compiler plugins
      levels:
          - high
      status: automated
      rules:
          - kernel_config_gcc_plugin_latent_entropy
          - kernel_config_gcc_plugin_stackleak
          - kernel_config_gcc_plugin_structleak
          - kernel_config_gcc_plugin_structleak_byref_all
          - kernel_config_gcc_plugin_randstruct

    - id: R22
      title: Compile options for the IP stack
      levels:
          - high
      notes: >-
          This control doesn't disable the IPv6 stack, to disable it select the related
          rule.
      status: automated
      rules:
          - kernel_config_syn_cookies
      related_rules:
          - kernel_config_ipv6

    - id: R23
      title: Compile options for various kernel behaviors
      levels:
          - high
      notes: >-
          If the system can function without support for kernel modules, module support
          should be disabled
          by setting CONFIG_MODULES=n.
      status: automated
      rules:
          - kernel_config_kexec
          - kernel_config_hibernation
          - kernel_config_binfmt_misc
          - kernel_config_legacy_ptys

    - id: R24
      title: Compile options for 32-bit architectures
      levels:
          - high
      notes: >-
          Unless a X86 32bit kernel is explicitly supported by one of products in
          the project, this
          requirement is set to not applicable.
      rules: []
      status: not applicable

    - id: R25
      title: Compile options for x86_64 architectures
      levels:
          - high
      status: automated
      rules:
          # TODO: add support for variable for config_default_mmap_min_addr
          # CONFIG_DEFAULT_MMAP_MIN_ADDR=65536
          - kernel_config_default_mmap_min_addr
          - kernel_config_randomize_base
          - kernel_config_randomize_memory
          - kernel_config_ia32_emulation
          - kernel_config_modify_ldt_syscall

    - id: R26
      title: Compile options for ARM architectures
      levels:
          - high
      notes: >-
          Unless a ARM 32bit kernel is explicitly supported by one of products in
          the project, this
          requirement is set to not applicable.
      rules: []
      status: not applicable

    - id: R27
      title: Compile options for ARM 64 architectures
      levels:
          - high
      status: automated
      rules:
          # CONFIG_DEFAULT_MMAP_MIN_ADDR=32768
          - kernel_config_default_mmap_min_addr
          - kernel_config_randomize_base
          - kernel_config_arm64_sw_ttbr0_pan
          - kernel_config_unmap_kernel_at_el0

    - id: R28
      title: Partitioning type
      levels:
          - intermediary
      status: automated
#  this covers nodev options
      rules: []
      related_rules:
          # /proc hidepid = 2 Contains process information and the system
          - mount_option_proc_hidepid
          - var_mount_option_proc_hidepid=2

    - id: R29
      title: Access Restrictions on /boot
      levels:
          - enhanced
      description: >-
          When possible, it is recommended not to automatically mount the /boot partition.
          In any case, access to the /boot folder should only be allowed for the root
          user.
      notes: >-
          The /boot partition mounted is essential to perform certain administrative
          actions, for
          example updating the kernel. Therefore, for better stability, in this requirement
          only rules
          to restrict the access to /boot are selected. It is not changed how the
          /boot is mounted.
      status: automated
      rules: []
      related_rules:
          - mount_option_boot_noauto

    - id: R30
      title: Removal of unused user accounts
      levels:
          - minimal
      description: >-
          Unused user accounts must be deleted from the system.
      notes: >-
          The definition of unused user accounts is broad. It can include accounts
          whose owners don't use the system anymore, or users created by services
          or applications that should not be used.
          Automation by itself cannot discern which accounts are used or not.
      rules: []
      status: manual

    - id: R31
      title: User password strength
      levels:
          - minimal
      notes: >-
          The rules selected below establish a general password strength baseline
          of 100 bits, based on the recommendations of the technical note
          "Recommandations relatives à l'authentification multifacteur et aux mots
          de passe"
          (https://cyber.gouv.fr/publications/recommandations-relatives-lauthentification-multifacteur-et-aux-mots-de-passe)

          The baseline should be reviewed and tailored to the system's use case and
          needs.
      status: automated
      rules:
          # enable authselect to support following rules
          - var_accounts_maximum_age_root=365
          - var_password_pam_minlen=15
          - var_accounts_password_minlen_login_defs=15
          - var_password_pam_ocredit=1
          - var_password_pam_dcredit=1
          - var_password_pam_ucredit=1
          - var_password_pam_lcredit=1
          - var_accounts_passwords_pam_faillock_fail_interval=900
          - var_accounts_passwords_pam_faillock_deny=3
          - var_password_pam_tally2=5
          - var_accounts_passwords_pam_tally2_unlock_time=1800
          # Automatically unlock users after 15 min to prevent DoS
          - var_accounts_passwords_pam_faillock_unlock_time=900
          - var_password_pam_unix_remember=2
    - id: R32
      title: Configuring a timeout on local user sessions
      levels:
          - intermediary
      description: >-
          Local user sessions (console TTY, graphical session) must be locked after
          a certain period
          of inactivity.
      notes: >-
          ANSSI doesn't specify the length of the inactivity period, we are choosing
          10 minutes as reasonable
          number.
      status: automated
      rules:
          - var_logind_session_timeout=10_minutes
          - var_accounts_tmout=10_min

    - id: R33
      title: Use of dedicated administration accounts
      levels:
          - intermediary
      notes: >-
          By disabling direct root logins proper accountability is ensured.
          Users will login first, then escalate to privileged (root) access.
          Change of privilege operations must be based on executables to monitor the
          activities
          performed (for example sudo).
          Nonetheless, the content automation cannot ensure that each administrator
          was given a
          nominative administration account separate from his normal user account.
      status: automated
      rules: []
    - id: R34
      title: Deactivation of service accounts
      levels:
          - intermediary
      notes: >-
          It is difficult to generally identify the system's service accounts.
          UIDs of such accounts are generally between SYS_UID_MIN and SYS_UID_MAX,
          but their values
          are not enforced by the OS and can be changed over time.
          Assisting rules could list users which are not disabled for manual review.
      rules: []
      status: manual

    - id: R35
      title: Uniqueness and exclusivity of system service accounts
      levels:
          - intermediary
      description: >-
          Each service must have its own system account and be dedicated to it exclusively.
      notes: >-
          It is not trivial to identify whether a user account is a service account.
          UIDs of such accounts are generally between SYS_UID_MIN and SYS_UID_MAX,
          but their values
          are not enforced by the OS and can be changed over time.
      rules: []
      status: manual

    - id: R36
      title: Changing the default value of UMASK
      levels:
          - enhanced
      description: >-
          The default value of UMASK for the shells must be set to 0077 in order to
          allow read and
          write access to its owner only. This value can be defined in the configuration
          file
          /etc/profile that most shells (bash, dash, ksh…) will use.
          The default value of UMASK for services must be determined for each service,
          but in most
          cases, it should be set to 0027 (or more restrictive). This allows read
          access to its owner
          and its group, and a full access to its owner. For services such as systemd,
          this value can
          be defined directly in the configuration file of the service with the directive
          UMask=0027.
      notes: >-
          There are cases of Systemd services which would stop working in case umask
          would be configured to 0027 for all services. One such example is the
          Cups service which needs to create sockets which need to be available for
          all users. Therefore, this part of the requirement can't be automated.
      status: automated
      rules:
          - var_accounts_user_umask=077

    - id: R37
      title: Using access control features
      levels:
          - enhanced
      description: >-
          It is recommended to use the mandatory access control (MAC) features in
          addition to the traditional Unix user model (DAC), or possibly combine
          them with partitioning mechanisms.
      notes: >-
          Other partitioning mechanisms can include chroot and containers and are
          not contemplated
          in this requirement.
      status: automated
      rules:
          - var_selinux_state=enforcing

    - id: R38
      title: Group dedicated to the use of sudo
      levels:
          - enhanced
      description: >-
          A group dedicated to the use of sudo must be created, and only members of
          this
          group are allowed to execute sudo.
      status: automated
      rules:
          - var_sudo_dedicated_group=sudogrp
    - id: R39
      title: Sudo configuration guidelines
      levels:
          - intermediary
      status: automated
      rules:
          - var_sudo_umask=0077
    - id: R40
      title: Privileges of target sudo users
      description: The targeted users of a rule should be, as much as possible, 
          non privileged users.
      levels:
          - intermediary
      status: automated
      rules: []
    - id: R41
      title: Limiting the number of commands requiring the use of the EXEC 
          option
      levels:
          - enhanced
      description: >-
          The commands requiring the execution of sub-processes (EXEC tag) must be
          explicitly listed and their use should be reduced to a strict minimum.
      notes: >-
          Human review is required to assess if the set of commands requiring EXEC
          is minimal.
          An auxiliary rule could list rules containing EXEC tag, for analysis.
      rules: []
      status: manual

    - id: R42
      title: Good use of negation in a sudoers file
      levels:
          - intermediary
      description: The sudoers configuration rules should not involve negation.
      status: automated
      rules: []
    - id: R43
      title: Explicit arguments in sudo specifications
      levels:
          - intermediary
      status: automated
      rules: []
    - id: R44
      title: Editing files with sudo
      levels:
          - intermediary
      description: A file requiring sudo to be edited, must be edited through 
          the sudoedit command.
      notes: >-
          In R62 we established that the sudoers files should not use negations, thus
          the approach
          for this requirement is to ensure that sudoedit is the only text editor
          allowed.
          But it is difficult to ensure that allowed binaries aren't text editors
          without human
          review.
      rules: []
      status: manual

    - id: R45
      title: Enable AppArmor security profiles
      levels:
          - enhanced
      description: >-
          All AppArmor security profiles on the system must be enabled by default.
      status: automated
      rules: []
    - id: R46
      title: Activate SELinux with the Targeted Policy
      levels:
          - high
      description: >-
          It is recommended to enable the targeted policy when the distribution
          supports it and that it does not operate another security module than SELinux.
      status: automated
      rules:
          - selinux_policytype
          - var_selinux_policy_name=targeted

    - id: R47
      title: Containment of unprivileged interactive users
      levels:
          - high
      description: >-
          Interactive non-privileged users of a system must be confined by associating
          them with a SELinux
          confined user.
      notes: Interactive users who still need to perform administrative tasks 
          should not be confined with user_u.
      rules: []
      status: manual

    - id: R48
      title: Setting SELinux booleans
      levels:
          - high
      description: >-
          It is recommended to set the following Booleans:
          allow_execheap to off, forbids processes to make their heap executable;
          allow_execmem to off, forbids processes to have both write and execute rights
          on memory pages;
          allow_execstack to off, forbids processes to make their stack executable;
          secure_mode_insmod to on, prohibits dynamic loading of modules by any process;
          ssh_sysadm_login to off, forbids SSH logins to connect directly in sysadmin
          role.
      notes: In RHEL, the SELinux boolean allow_execheap is renamed to 
          selinuxuser_execheap, and the boolean allow_execstack is renamed to 
          selinuxuser_execstack. And allow_execmem is not available, 
          deny_execmem provides the same functionality.
      status: automated
      rules:
          - var_selinuxuser_execheap=off
          - sebool_selinuxuser_execheap
          - var_deny_execmem=on
          - sebool_deny_execmem
          - var_selinuxuser_execstack=off
          - sebool_selinuxuser_execstack
          - var_secure_mode_insmod=on
          - sebool_ssh_sysadm_login

    - id: R49
      title: Uninstalling SELinux Policy Debugging Tools
      levels:
          - high
      description: >-
          SELinux policy manipulation and debugging tools should not be installed
          on a machine in production.
      status: automated
      rules:
          - package_setroubleshoot_removed
          - package_setroubleshoot-server_removed
          - package_setroubleshoot-plugins_removed

    - id: R50
      title: Rights to access sensitive files and directories
      levels:
          - intermediary
      status: automated
      rules: []
    - id: R51
      title: Sensitive and trusted files
      levels:
          - enhanced
      description: >-
          All sensitive files and those contributing to the authentication mechanisms
          must be set up as soon as the system is installed. If default secrets are
          preconfigured, they must be replaced during, or immediately after, the
          installation phase of the system.
      notes: >-
          This concerns two aspects, the first is administrative, and involves prompt
          installation of secrets or trusted elements by the sysadmin.
          The second involves removal of any default secret or trusted element
          configured by the operating system during install process, e.g. default
          known passwords.
      rules: []
      status: documentation

    - id: R52
      title: Securing access for named sockets and pipes
      levels:
          - intermediary
      notes: |-
          The requirement states that all sockets and named pipes within all mounted
          file systems should be checked. The check should look at the permissions
          of the socket / pipe and compare them with permissions of the directory
          which contains the particular socket. In case permissions of the directory
          are less stricter than permissions of the socket, this should be
          considered a finding. Since different use cases can require different
          permissions for named pipes / sockets, it is not possible to perform this
          check automatically.
      rules: []
      status: manual

    - id: R53
      title: Files or directories without a known user or group
      levels:
          - minimal
      status: automated
      rules: []
    - id: R54
      title: Sticky bit and write access rights
      levels:
          - minimal
      status: automated
      rules: []
    - id: R55
      title: Temporary directories dedicated to accounts
      levels:
          - intermediary
      description: >-
          Each user or service account must have its own temporary directory
          and dispose of it exclusively.
      notes: The approach of the selected rules is to use and configure 
          pam_namespace module.
      status: automated
      rules:
          - var_polyinstantiation_enabled=on
    - id: R56
      title: Executables with setuid and setgid bits
      levels:
          - minimal
      notes: >-
          Only programs specifically designed to be used with setuid or setgid bits
          can have these privilege
          bits set.
          This requirement considers apropriate for setuid and setgid bits the binaries
          that are installed
          from
          recognized and authorized repositories (covered in R15).
          The remediation resets the sticky bit to intended value by vendor/developer,
          any finding after
          remediation
          should be reviewed.
      status: automated
      rules: []
    - id: R57
      title: Executable with special rights setuid root and setgid root
      levels:
          - enhanced
      description: >-
          The executables with setuid executables root and setgid root special rights
          should be as few
          as possible.
          When only administrators are expected to execute them, these special rights
          should
          be removed and prefer them commands like su or sudo, which can be monitored
      notes: There could be rules to list all executables with setuid root or 
          setgid root rights.
      rules: []
      status: manual

    - id: R58
      title: Installation of packages reduced to the bare necessities
      levels:
          - minimal
      description: >-
          The selection of packages installed should be as small as possible,
          limiting itself to select only what is required.
      notes: >-
          It is not possible to automatically decide in general way if a package is
          required or not for
          given system.
          As a future improvement, there could be rules assisting assessment by listing
          the installed
          packages.
      rules: []
      status: manual

    - id: R59
      title: Official package repositories
      levels:
          - minimal
      description: Only up-to-date official repositories of the distribution 
          must be used.
      notes: >-
          It is not trivial to distinguish an official repository from an unofficial
          one.
          We cannot draw conclusions from the repo name or URL of the repo (as they
          can be arbitrary
          or behind a proxy).
          One approach to check the origin of installed packages is to check the signature
          of the packages.
          If the public key of a repository is not installed, the repo is not trusted.
      status: automated
      rules: []
    - id: R60
      title: Hardened package repositories
      levels:
          - enhanced
      description: >-
          When the distribution provides several types of repositories, preference
          should be given to those containing packages subject to additional
          hardening measures.
          Between two packages providing the same service, those subject to hardening
          (at compilation, installation, or default configuration) must be preferred.
      rules: []
      status: not applicable

    - id: R61
      title: Regular updates
      levels:
          - minimal
      notes: Check the vendor CVE feed and configure automatic install of 
          security related updates.
      status: automated
      rules: []
    - id: R62
      title: Minimization of installed services
      levels:
          - minimal
      description: >-
          Only the components strictly necessary to the service provided by the system
          should
          be installed.
          Those whose presence can not be justified should be disabled, removed or
          deleted.
      status: manual  # The list of essential services is not objective.
      notes: >-
          Performing a minimal install is a good starting point, but doesn't provide
          any assurance
          over any package installed later.
          Manual review is required to assess if the installed services are minimal.
          In general, use of obsolete or insecure services is not recommended and
          we remove some
          of these in this recommendation.
      rules: []
    - id: R63
      title: Minimization of services configuration
      levels:
          - intermediary
      description: >-
          Services are often installed with default configurations that enable features
          potentially
          problematic from a security point of view.
          The features configured at the level of launched services should be limited
          to the strict
          minimum.
      notes: >-
          Define a list of most problematic components or features to be hardened
          or restricted.
      rules: []
      status: manual

    - id: R64
      title: Least privilege for the services
      levels:
          - enhanced
      description: >-
          The deployed services must have their access restricted to the system
          strict minimum, especially when it comes to files, processes or network.
      notes: >-
          SELinux policies limit the privileges of services and daemons just to those
          which are required.
          The policies should be enough to restrict the services' privileges to its
          essentials, but the
          automated content cannot assess whether they are the minimum required for
          the deployment.
      status: automated
      rules:
          - selinux_policytype
          - var_selinux_policy_name=targeted

    - id: R65
      title: Services partitioning
      levels:
          - enhanced
      notes: >-
          Using automation to restrict access and chroot services is not generally
          reliable.
      rules: []
      status: manual

    - id: R66
      title: Virtualization components hardening
      levels:
          - high
      description: >-
          Each component supporting the virtualization must be hardened, especially
          by applying technical measures to counter the exploit attempts.
      notes: >-
          We cannot easily automate securing of virtualization technologies in a general
          way.
          It may be interesting to point out virtualization components that are installed
          and
          should be hardened.
      rules: []
      status: manual

    - id: R67
      title: Secure remote authentication with PAM
      levels:
          - intermediary
      description: |-
          When authentication takes place through a remote application (network),
          the authentication protocol used by PAM must be secure (flow encryption,
          remote server authentication, anti-replay mechanisms, ...).
      notes: |-
          In systems where remote authentication is handled through sssd service, PAM delegates
          requests for remote authentication to sssd service through a local Unix socket. The sssd
          service can use IPA, AD or LDAP as a remote database containing information required for authentication.
          In case LDAP is configured manually, there are several configuration options which should be chedked.
      status: automated
      rules: []
      related_rules:
          - package_sssd-ipa_installed

    - id: R68
      title: Protecting stored passwords
      levels:
          - minimal
      description: Any password must be protected by cryptographic mechanisms.
      notes: >-
          The selection of rules doesn't cover the use of hardware devices to protect
          the passwords.
      status: supported
      rules:
          - var_password_hashing_algorithm=yescrypt
          - var_password_hashing_algorithm_pam=sha512
          - var_password_pam_unix_rounds=11
          - var_password_pam_minclass=4

    - id: R69
      title: Securing access to remote user databases
      levels:
          - intermediary
      description: |-
          When the user databases are stored on a remote network service, NSS must
          be configured to establish a secure link that allows, at minimum, to
          authenticate the server and protect the communication channel.
      notes: |-
          A nsswitch service connecting to remote database is provided by sssd. This is checked in requirement R67.
          Another such service is winbind which is by default configured to connect securely to Samba domains.
          Other relevant services are NIS and Hesiod. These should not be used.
      status: pending
      rules: []
      related_rules:
          - no_nis_in_nsswitch

    - id: R70
      title: Separation of System Accounts and Directory Administrator
      levels:
          - intermediary
      rules: []
      status: manual

    - id: R71
      title: Implement a logging system
      levels:
          - enhanced
      description: >-
          The configuration of the service must be performed according to the
          'Security Recommendations for the architecture of a logging system'
          (DAT-PA-012 v2.0) accessible on the ANSSI website
          (https://www.ssi.gouv.fr/journalisation).
      notes: >-
          A lot of recommendations and requirements from the DAT-PA-012 document are
          administrative and
          hard to automate.
          The rules selected below address a few of the aspects that can be covered,
          keep in mind that
          these configurations should
          be customized for the systems deployment requirements.
      status: automated
#  Based on DAT-PA-012 R5
      rules: []
    - id: R72
      title: Service Activity Logs
      levels:
          - enhanced
      description: >-
          Each service must have a dedicated event logging journal on the system.
          This log must only be accessible by the syslog server, and must not be readable,
          editable or deletable by the service directly.
      rules: []
      status: documentation  # How to enable syslog for each service installed in the system

    - id: R73
      title: Logging activity by auditd
      levels:
          - enhanced
      description: >-
          The logging of the system activity must be done through the auditd service.
      status: automated
      rules: []
    - id: R74
      title: Configuring the local messaging service
      levels:
          - intermediary
      status: automated
      rules: []
    - id: R75
      title: Messaging Aliases for Service Accounts
      levels:
          - intermediary
      status: automated  # semi-automated
      notes: >-
          Only the alias for root user is covered by the rule.
          The other services cannot be reliably covered, as there is no simple way
          of determining what is a service account.
      rules: []
    - id: R76
      title: Sealing and integrity of files
      levels:
          - high
      description: >-
          Any file that is not transient (such as temporary files, databases, etc.)
          must be monitored by a sealing program.
          This includes: directories containing executables, libraries,
          configuration files, as well as any files that may contain sensitive
          elements (cryptographic keys, passwords, confidential data).
      status: automated
      rules:
          - package_aide_installed
          - aide_build_database
          - aide_periodic_cron_checking
          - aide_scan_notification
          - aide_verify_acls
          - aide_verify_ext_attributes

    - id: R77
      title: Protection of the seals database
      levels:
          - high
      description: >-
          The sealing database must be protected from malicious access by
          cryptographic signature mechanisms (with the key used for the signature
          not locally stored in clear), or possibly stored on a separate machine
          of the one on which the sealing is done.
          Check section "Database and config signing in AIDE manual"
          https://aide.github.io/doc/#signing
      rules: []
      status: does not meet

    - id: R78
      title: Network services partitioning
      levels:
          - enhanced
      description: >-
          Network services should as much as possible be hosted on isolated environments.
          This avoids having other potentially affected services if one of them gets
          compromised under the same environment.
      notes: >-
          Manual analysis is required to determine if services are hosted appropriately
          in
          separate or isolated system while maintaining functionality.
      rules: []
      status: manual

    - id: R79
      title: Hardening and monitoring of exposed services
      levels:
          - intermediary
      notes: >-
          SELinux can provide confinement and monitoring of services, and AIDE provides
          basic integrity checking. System logs are configured as part of R43.
          Hardening of particular services should be done on a case by case basis
          and is
          not automated by this content.
      status: partial
      rules:
          - var_selinux_state=enforcing
          - package_aide_installed
          - aide_build_database

    - id: R80
      title: Minimization of network services
      levels:
          - minimal
      description: All network services must be listening on the correct network
          intefaces.
      notes: >-
          Manual review is necessary to decide if the list of resident daemons is
          minimal.
          Assisting rules could be created to list sevices listening on the network
          for manual review.
      rules: []
      status: manual
