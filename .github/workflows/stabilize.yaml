name: Stabilize
on:
  push:
    branches: [ 'stabilization*' ]
jobs:
  stabilize-fedora:
    name: Build and Stabilization Tests on Fedora Latest (Container)
    runs-on: ubuntu-latest
    container:
      image: fedora:latest
    steps:
      - name: Install Deps
        run: dnf install -y cmake ninja-build openscap-utils python3-pyyaml python3-jinja2 python3-pytest ansible expat libxslt python3-ansible-lint linkchecker
      - name: Checkout
        uses: actions/checkout@v2
      - name: Configure
        run: cmake -DSSG_OVAL_SCHEMATRON_VALIDATION_ENABLED=OFF -DANSIBLE_CHECKS=ON ..
        working-directory: ./build
      - name: Build All
        run: make -j2 all
        working-directory: ./build
      - name: Lint Check
        # Performs ansible-lint and yamllint checks on generated ansible playbooks
        run: ctest -j2 -R ansible-playbook --output-on-failure
        working-directory: ./build
      - name: Link Check
        # Performs linkcheck across all build tables and html guides to ensure there are no broken references.
        run: ctest -j2 -R linkchecker --output-on-failure
        working-directory: ./build
