name: Style Guide
on:
  pull_request:
    branches: [ 'master', 'stabilization*' ]
jobs:
  style_guide:
      name: Style Guide Linter
      runs-on: ubuntu-latest
      container:
        image: fedora:latest
      steps:
      - name: Install Dependencies 
        run: dnf install -y grep findutils git
      # https://github.com/actions/checkout/issues/766
      - name: Set git safe directory
        run: git config --global --add safe.directory "$GITHUB_WORKSPACE"
      - name: Files must use LF Line endings
        run: find . -not -type d -exec file "{}" ";" | grep CRLF
      - name: Files must end in LF Endings
        if: always()
        run: |-
          git diff --name-only ${{ github.event.pull_request.base.sha }} ${{ github.sha }} | xargs -L1 bash -c 'if test "$(tail -c 1 "$0")"; then echo "No new line at end of $0"; exit 1; fi'
      - name: There should not be any merge commits
        if: always()
        run: |-
          git log ${{ github.event.pull_request.base.sha }} ${{ github.sha }} | grep Merge:
