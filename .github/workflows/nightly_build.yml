name: Nightly builds with OVAL 5.11
on:
    schedule:
        # Run daily at 03:00
        -   cron: "0 3 * * *"
jobs:
    nightly-fedora:
        name: Nightly build on Fedora Latest (Container)
        runs-on: ubuntu-latest
        container:
            image: fedora:latest
        steps:
            -   name: Install Dependencies
                run: dnf install -y cmake ninja-build openscap-utils python3-pip python3-devel gcc-c++ ansible-lint libxslt ansible python3-setuptools
            -   name: Checkout
                uses: actions/checkout@de0fac2e4500dabe0009e67214ff5f5447ce83dd # v4
            -   name: Install python deps
                run: pip install -r requirements-base.txt -r test-requirements.txt
            -   name: Configure
                run: cmake -G Ninja ..
                working-directory: ./build
            -   name: Build All
                run: ninja -j$(nproc) all
                working-directory: ./build
            -   name: Build ZIP
                run: ninja -j$(nproc) zipfile
                working-directory: ./build
            -   name: Test
                run: ctest -j$(nproc) --output-on-failure -E linkchecker
                working-directory: ./build
            -   name: Build Package Source
                run: ninja -j$(nproc) package_source
                working-directory: ./build
            -   name: 'Upload Artifact'
                uses: actions/upload-artifact@bbbca2ddaa5d8feaa63e36b76fdaad77386f024f # v4
                with:
                  name: Nightly Build
                  path: |
                        build/zipfile/scap-security-guide-*.zip
                        build/zipfile/scap-security-guide-*.zip.sha512
