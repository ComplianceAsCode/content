documentation_complete: true


title: 'Ensure catch-all FlowSchema object for API Priority and Fairness Exists (v1alpha1)'

description: |-
  Using `APIPriorityAndFairness` feature provides a fine-grained way
  to control the behaviour of the Kubernetes API server in an overload
  situation. The well-known FlowSchema `catch-all` should be available
  to make sure that every request gets some kind of classification. By default,
  the `catch-all` priority level only allows one concurrency share and
  does not queue requests. To inspect all the `FlowSchema` objects, run:
  ```oc get flowschema```
  To inspect the well-known `catch-all` object, run the following:
  ```oc describe flowschema catch-all```

rationale: |-
  The `FlowSchema` API objects enforce a limit on the
  number of events that the API Server will accept in a given time slice
  In a large multi-tenant cluster, there might be a small percentage of
  misbehaving tenants which could have a significant impact on the
  performance of the cluster overall. It is recommended to limit the rate
  of events that the API Server will accept.

identifiers:
  cce@ocp4: CCE-84002-5


platform: ocp4.6 or ocp4.7

severity: medium

references:
  cis@ocp4: 1.2.10
  nerc-cip: CIP-003-8 R6,CIP-004-6 R3,CIP-007-3 R6.1
  nist: CM-6,CM-6(1)
  pcidss: Req-2.2
  srg: SRG-APP-000516-CTR-001325

ocil_clause: 'A FlowSchema object `catch-all` exists'

ocil: |-
  Run the following commands:
  ```oc get flowschema```
  and inspect the FlowSchema objects. Make sure that at least the `catch-all`
  object exists by calling:
  ```oc describe flowschema catch-all```

warnings:
- general: |-
    {{{ openshift_cluster_setting("/apis/flowcontrol.apiserver.k8s.io/v1alpha1/flowschemas/catch-all", true) | indent(4) }}}
- dependency: |-
    Note that this rule is only applicable in OpenShift Container Platform
    versions 4.7 and below.

template:
  name: yamlfile_value
  vars:
    ocp_data: "true"
    filepath: "/apis/flowcontrol.apiserver.k8s.io/v1alpha1/flowschemas/catch-all"
    yamlpath: '.spec.rules[0].subjects[:].group["name"]'
    check_existence: "at_least_one_exists"
    entity_check: "at least one"
    values:
      - value: "system:authenticated"
        operation: "pattern match"
        check_existence: "at_least_one_exists"
        entity_check: "at least one"
