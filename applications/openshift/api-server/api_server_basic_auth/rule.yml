documentation_complete: true


title: 'Disable basic-auth-file for the API Server'

{{% set default_jqfilter = '.data."config.yaml" | fromjson' %}}
{{% set default_api_path = '/api/v1/namespaces/openshift-kube-apiserver/configmaps/config' %}}
{{% set hypershift_path = '/api/v1/namespaces/{{.hypershift_namespace_prefix}}-{{.hypershift_cluster}}/configmaps/kas-config' %}}
{{% set hypershift_jqfilter = '.data."config.json" | fromjson' %}}
{{% set custom_api_path = '{{if ne .hypershift_cluster "None"}}' ~ hypershift_path ~ '{{else}}' ~  default_api_path ~ '{{end}}' %}}
{{% set custom_jqfilter = '{{if ne .hypershift_cluster "None"}}' ~ hypershift_jqfilter ~ '{{else}}' ~  default_jqfilter ~ '{{end}}' %}}
{{% set dump_path = default_api_path ~ ',' ~ default_jqfilter ~ ',' ~ custom_jqfilter %}}

description: |-
    Disable basic authentication for the API Server to prevent the use of
    insecure authentication methods. Remove the `basic-auth-file` parameter
    from the `openshift-kube-apiserver` configmap if it exists. Use alternate
    authentication mechanisms such as tokens and certificates instead.

rationale: |-
    Basic authentication uses plaintext credentials for authentication.
    Currently, basic authentication credentials last indefinitely, and the
    password cannot be changed without restarting the API Server. Basic
    Authentication is supported for convenience and is not intended for
    production workloads. Using basic authentication exposes credentials in
    plaintext and creates significant security vulnerabilities.

identifiers:
  cce@ocp4: CCE-83936-5


severity: medium

references:
    cis@ocp4: 1.2.2
    nerc-cip: CIP-003-8 R6,CIP-004-6 R3,CIP-007-3 R6.1
    nist: CM-6,CM-6(1)
    pcidss: Req-2.2
    srg: SRG-APP-000516-CTR-001325

platform: not ocp4-on-hypershift-hosted

ocil_clause: 'basic-auth-file is configured and enabled for the API server'

ocil: |-
    Verify that basic authentication is disabled by running the following command:

    ```
    $ oc get configmap config -n openshift-kube-apiserver -ojson | \
      jq -r '.data["config.yaml"]' | jq '.apiServerArguments["basic-auth-file"]'
    ```

    The output should be empty as OpenShift does not support basic authentication.

warnings:
    - general: |-
        {{{ openshift_filtered_cluster_setting({custom_api_path: dump_path}) | indent(8) }}}

template:
    name: yamlfile_value
    vars:
        ocp_data: "true"
        filepath: {{{ openshift_filtered_path(default_api_path, default_jqfilter) }}}
        yamlpath: '.apiServerArguments[:]'
        check_existence: "none_exist"
        values:
            - key: 'basic-auth-file'
              type: "string"
              operation: "pattern match"
