documentation_complete: true


title: 'Ensure that the Admission Control Plugin AlwaysPullImages is not set'

{{% set default_jqfilter = '[.data."config.yaml" | fromjson]' %}}
{{% set default_api_path = '/api/v1/namespaces/openshift-kube-apiserver/configmaps/config' %}}
{{% set hypershift_path = '/api/v1/namespaces/{{.hypershift_namespace_prefix}}-{{.hypershift_cluster}}/configmaps/kas-config' %}}
{{% set hypershift_jqfilter = '[.data."config.json" | fromjson]' %}}
{{% set custom_api_path = '{{if ne .hypershift_cluster "None"}}' ~ hypershift_path ~ '{{else}}' ~  default_api_path ~ '{{end}}' %}}
{{% set custom_jqfilter = '{{if ne .hypershift_cluster "None"}}' ~ hypershift_jqfilter ~ '{{else}}' ~  default_jqfilter ~ '{{end}}' %}}
{{% set dump_path = default_api_path ~ ',' ~ default_jqfilter ~ ',' ~ custom_jqfilter %}}

description: |-
    Ensure the AlwaysPullImages admission control plugin is disabled to prevent
    potential failure modes for control plane components when image registries
    become unreachable.

rationale: |-
    The AlwaysPullImages admission control policy forces every pod to pull
    required images each time, providing multi-tenant security by ensuring
    private images require proper credentials. Without this policy, any pod can
    use previously pulled images by knowing the image name without authorization.
    
    However, enabling this plugin introduces cluster failure modes in OpenShift
    4. Master and infrastructure components are deployed as pods, and registry
    outages can cause redeployed infrastructure pods (like oauth-server) to fail
    on image pulls for locally present images. Using `PullIfNotPresent` prevents
    pods from failing during registry outages. The imagePullPolicy should be
    managed per container instead. Without proper configuration, enabling
    AlwaysPullImages can cause critical infrastructure failures during registry
    unavailability.


severity: high

references:
    cis@ocp4: 1.2.11
    nerc-cip: CIP-003-8 R6,CIP-004-6 R3,CIP-007-3 R6.1
    nist: CM-6,CM-6(1)
    pcidss: Req-2.2
    srg: SRG-APP-000516-CTR-001325

platform: not ocp4-on-hypershift-hosted

ocil_clause: '`AlwaysPullImages` is included in `admissionConfig`'

ocil: |-
    Verify the AlwaysPullImages plugin is not enabled:
    ```
    $ oc -n openshift-kube-apiserver get configmap config -o json | jq -r \
      '.data."config.yaml"' | jq '.apiServerArguments."enable-admission-plugins"'
    ```
    The output list should not contain `"AlwaysPullImages"`.

warnings:
- general: |-
    {{{ openshift_filtered_cluster_setting({custom_api_path: dump_path}) | indent(4) }}}

template:
  name: yamlfile_value
  vars:
    ocp_data: "true"
    check_existence: "none_exist"
    filepath: {{{ openshift_filtered_path(default_api_path, default_jqfilter) }}}
    yamlpath: '.apiServerArguments["enable-admission-plugins"][:]'
    values:
    - value: '^AlwaysPullImages$'
      operation: "pattern match"
