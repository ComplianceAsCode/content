documentation_complete: true


title: 'Ensure that anonymous requests to the API Server are authorized'

description: |-
    Ensure anonymous requests to the OpenShift API are properly authorized.
    By default, anonymous access is enabled but all requests must be
    authorized. Requests without authentication mechanisms are assigned the
    `system:anonymous` virtual user and `system:unauthenticated` virtual
    group, allowing the authorization layer to determine permitted anonymous
    operations.

    Verify authorization rules for anonymous requests:
    ```
    $ oc describe clusterrolebindings
    ```
    Inspect bindings for the `system:anonymous` virtual user and
    `system:unauthenticated` virtual group.

    Test anonymous access to the `readyz` endpoint:
    ```
    $ oc get --as="system:anonymous" --raw='/readyz?verbose'
    ```
    Verify restricted access to projects:
    ```
    $ oc get --as="system:anonymous" projects
    ```

rationale: |-
    Requests not rejected by configured authentication methods become anonymous
    requests served by the API server. With RBAC authorization, allowing
    anonymous access for health checks and discovery purposes is generally
    reasonable. However, organizations must evaluate whether anonymous discovery
    presents acceptable security risks. Without proper anonymous request
    controls, unauthorized users could potentially discover cluster information
    or access unintended resources.

severity: medium

references:
    cis@ocp4: 1.2.1
    nerc-cip: CIP-003-8 R6,CIP-004-6 R3,CIP-007-3 R6.1
    nist: CM-6,CM-6(1)
    pcidss: Req-2.2
    srg: SRG-APP-000516-CTR-001325

ocil_clause: 'anonymous requests are not authorized'

ocil: |-
    View authorization rules for anonymous requests:
    ```
    $ oc describe clusterrolebindings
    ```
    Verify at least one `clusterrolebinding` binds either the
    `system:unauthenticated` group or the `system:anonymous` user.
    
    Test anonymous access to the `readyz` endpoint:
    ```
    $ oc get --as="system:anonymous" --raw='/readyz?verbose'
    ```
    Verify restricted access to projects:
    ```
    $ oc get --as="system:anonymous" projects
    ```

warnings:
- general: |-
    {{{ openshift_cluster_setting("/apis/rbac.authorization.k8s.io/v1/clusterrolebindings") | indent(4) }}}

template:
    name: yamlfile_value
    vars:
        ocp_data: "true"
        filepath: /apis/rbac.authorization.k8s.io/v1/clusterrolebindings
        yamlpath: ".items[:]['subjects'][:].name"
        check_existence: "at_least_one_exists"
        entity_check: "at least one"
        values:
          - value: "system:unauthenticated"
            entity_check: "at least one"
            operation: "pattern match"
            check_existence: "at_least_one_exists"
