# platform = Red Hat Enterprise Linux 7,multi_platform_fedora,multi_platform_rhv,Oracle Linux 7
# reboot = false
# strategy = configure
# complexity = low
# disruption = low
- name: Check existence of modutil
  stat:
    path: /usr/bin/modutil
  register: modutil_bin

- name: Remove coolkey module if exists
  command: modutil -delete "CoolKey PKCS {{ '#' }}11 Module" -dbdir sql:/etc/pki/nssdb/ -force
  when: modutil_bin.stat.exists
  ignore_errors: True

- name: "{{{ rule_title }}}"
  command: /usr/bin/modutil -add "OpenSC PKCS {{ '#' }}11 Module" -dbdir sql:/etc/pki/nssdb/ -libfile opensc-pkcs11.so -force
  when: modutil_bin.stat.exists
