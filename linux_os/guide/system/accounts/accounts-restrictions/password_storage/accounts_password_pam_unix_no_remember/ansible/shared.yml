# platform = multi_platform_rhel,multi_platform_fedora,multi_platform_ol,multi_platform_rhv,multi_platform_almalinux,multi_platform_ubuntu
# reboot = false
# strategy = configure
# complexity = low
# disruption = medium

{{% if 'ubuntu' in product or 'debian' in product %}}
{{%- set pam_config_paths = "['/etc/pam.d/common-password', '/etc/pam.d/common-auth', '/etc/pam.d/common-account', '/etc/pam.d/common-session', '/etc/pam.d/common-session-noninteractive']" %}}

- name: '{{{ rule_title }}} - Remove remember option from pam_unix.so'
  ansible.builtin.replace:
    dest: "{{ item }}"
    regexp: '(\s+pam_unix\.so.*)\s+remember=\d+\b(.*)'
    replace: '\1\2'
  loop: {{{ pam_config_paths }}}
{{% else %}}
{{{ ansible_remove_pam_module_option_configuration('/etc/pam.d/system-auth', 'password', '', 'pam_unix.so', 'remember', rule_title=rule_title) }}}

{{{ ansible_remove_pam_module_option_configuration('/etc/pam.d/password-auth', 'password', '', 'pam_unix.so', 'remember', rule_title=rule_title) }}}
{{% endif %}}
