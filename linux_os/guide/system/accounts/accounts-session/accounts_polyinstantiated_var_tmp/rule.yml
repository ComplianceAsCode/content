{{%- set basedir="/var/tmp" -%}}
documentation_complete: true

title: Configure Polyinstantiation of {{{ basedir }}} Directories

description: |-
  To configure polyinstantiated
  <tt>{{{ basedir }}}</tt>
  directories, first create the parent directories which will hold the
  polyinstantiation child directories. Use the following command:
  <pre>$ sudo mkdir --mode 000 {{{ basedir }}}/tmp-inst</pre>
  Then, add the following entry to <tt>/etc/security/namespace.conf</tt>:
  <pre>{{{ basedir }}} {{{ basedir }}}/tmp-inst/    level      root,adm</pre>

rationale: |-
  Polyinstantiation of temporary directories is a proactive security measure
  which reduces chances of attacks that are made possible by
  <tt>{{{ basedir }}}</tt>
  directories being world-writable.

warnings:
  - general: |-
      Test any mitigations at test machine with working <em>rescue</em>
      method.

      Consider adding: <tt>ignore_config_error</tt> as
      <tt>pam_namespace.so</tt> option during testing.

      If SELinux is used and you are adding new files under:
      <tt>/etc/security/namespace.d</tt> ensure you create file with right
      context from start. Mistake will make system unable to accept new logins
      and you need to reboot to rescue mode and trigger relabel.

      Typo in <tt>namespace.conf</tt> can cause severe issues that require
      rescue mode to recover.

severity: low

identifiers:
  cce@rhel7: CCE-83777-3
  cce@rhel8: CCE-83778-1
  cce@rhel9: CCE-83642-9
  cce@sle12: CCE-91507-4
  cce@sle15: CCE-91198-2

references:
  anssi: BP28(R39)

ocil_clause: is not configured

ocil: |-
  Run the following command to ensure that
  <tt>{{{ basedir }}}</tt>
  is configured as a polyinstantiated directory:
  <pre>$ sudo grep -hr '^[^#]' /etc/security/namespace.conf /etc/security/namespace.d</pre>
  The output should return the following:
  <pre>{{{ basedir }}} {{{ basedir }}}/tmp-inst/    level      root,adm</pre>
