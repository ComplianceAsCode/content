# platform = multi_platform_all
# reboot = false
# strategy = restrict
# complexity = low
# disruption = low

- name: '{{{ rule_title }}} - Gather User Info'
  ansible.builtin.getent:
    database: passwd

- name: '{{{ rule_title }}} - Fix Bash History Files Permissions'
  ansible.builtin.file:
    path: "{{ item.value[4] }}/.bash_history"
    mode: u-sx,go=
  with_dict: "{{ ansible_facts.getent_passwd }}"
  when:
    - item.value[4] != "/sbin/nologin"
    - item.key not in ["nobody", "nfsnobody"]
    - item.value[1] | int >= {{{ uid_min }}}
