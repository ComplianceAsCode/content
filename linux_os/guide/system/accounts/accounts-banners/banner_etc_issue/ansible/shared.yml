# platform = multi_platform_all
# reboot = false
# strategy = unknown
# complexity = low
# disruption = medium
{{{ ansible_instantiate_variables("login_banner_contents") }}}

{{%- if product not in ['sle15', 'slmicro5', 'slmicro6'] -%}}
- name: "{{{ rule_title }}} - Ensure Correct Banner"
  ansible.builtin.copy:
    dest: /etc/issue
    content: "{{ login_banner_contents | replace('\\n', '\n') }}\n"
{{%- else -%}}
- name: {{{ rule_title }}} Ensure issue-generator is Installed
  ansible.builtin.package:
    name: "issue-generator"
    state: present

- name: "{{{ rule_title }}} - Ensure Correct Banner"
  ansible.builtin.copy:
    dest: /etc/issue.d/99-oscap-setting
    content: "{{ login_banner_contents | replace('\\n', '\n') }}\n"

- name: "{{{ rule_title }}} - Restart issue-generator Service on Issue Configuration Change"
  ansible.builtin.systemd:
    name: "issue-generator"
    enabled: "yes"
    state: "restarted"
    masked: "no"
{{%- endif -%}}
