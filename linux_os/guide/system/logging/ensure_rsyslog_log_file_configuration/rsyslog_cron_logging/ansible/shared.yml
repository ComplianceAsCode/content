# platform = multi_platform_all
# reboot = false
# strategy = configure
# complexity = low
# disruption = low

{{{ ansible_setup_rsyslog_common(rule_title) }}}

{{{ ansible_remove_rainerscript_range_entries(rule_title, "[[:space:]]*cron\.\*.*action(", ")", "cron.* action()") }}}

{{{ ansible_lineinfile(msg="Remove *.* entries pointing to /var/log/cron from rsyslog.conf",
                       path="/etc/rsyslog.conf",
                       regex='^\s*\*\.\*\s+/var/log/cron\s*$',
                       state='absent',
                       rule_title=rule_title)
}}}

-   name: "{{{ rule_title }}} - Remove *.* entries pointing to /var/log/cron from rsyslog.d/*.conf"
    ansible.builtin.shell: find /etc/rsyslog.d -type f -name "*.conf" -exec sed -i '\|^\s*\*\.\*\s\+/var/log/cron\s*$|d' {} +
    changed_when: true

{{{ ansible_set_config_file_dir(msg, "/etc/rsyslog.conf", "/etc/rsyslog.d", "/etc/rsyslog.d/cron.conf",
                                "cron.*", separator='\t', separator_regex='',
                                value="/var/log/cron", create='yes', rule_title=rule_title)
}}}

-   name: "{{{ rule_title }}} - Restart the rsyslog service now"
    ansible.builtin.service:
        name: rsyslog
        state: restarted
