# platform = Red Hat Enterprise Linux 7,Red Hat Enterprise Linux 8,multi_platform_rhv,multi_platform_fedora
# reboot = false
# strategy = restrict
# complexity = low
# disruption = low

- name: Ensure non-privileged users do not have access to nmcli
  ini_file:
    path: /etc/polkit-1/localauthority/20-org.d/10-nm-harden-access.pkla
    section: Disable General User Access to NetworkManager
    option: "{{ item.option }}"
    value: "{{ item.value }}"
    no_extra_spaces: yes
    create: yes
  loop:
    - { option: 'Identity', value: 'default' }
    - { option: 'Action', value: 'org.freedesktop.NetworkManager.*' }
    - { option: 'ResultAny', value: 'no' }
    - { option: 'ResultInactive', value: 'no' }
    - { option: 'ResultActive', value: 'auth_admin' }
