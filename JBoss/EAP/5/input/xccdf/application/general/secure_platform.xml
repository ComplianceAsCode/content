<Group id="secure_platform">
<title>Securing JBoss platform</title>
<description>
The rules in this group are used to secure the JBoss platform and its
dependencies.
</description>

<Rule id="jboss_eap_java_security_manager_policy" severity="medium">
<title>Configure the Java Security Manager's Environment Policy</title>
<description>
The Java Security Manager is a crucial piece of the Java security
infrastructure. JBoss Enterprise Application Platform should be configured to
load a Java security policy that has been vetted for use in the environment.
This precludes the use of the simple default policy that ships with JBoss, but
does not preclude the use of preconfigured policy files like the security
policy designed for use in a Common Criteria environment (See JBoss Common
Criteria Configuration Guide for details).
</description>
<ocil clause="it is not configured or not configured correctly">
</ocil>
<rationale>
A weak, default, or incomplete Java Security Manager policy file can completely
compromise the security of a Java installation by granting excessive
permissions to applications running within the sandbox. These permissions can
be leveraged (maliciously or not) to run code against the operating system.
</rationale>



<fixtext>
To load an environment specific security policy, simply append the following line to JBOSS_HOME/bin/run.conf or JBOSS_HOME/bin/run.conf.bat as appropriate (depending on the host operating system).

<xhtml:pre>
<xhtml:code>
JAVA_OPTS="$JAVA_OPTS -Djava.security.manager -Djava.security.policy==[PATH TO POLICY FILE]"
</xhtml:code>

</xhtml:pre>

NOTE: Using a prepackaged policy file is acceptable, as long as the policy file has been reviewed for compatibility and security within the current environment.


</fixtext>
<ident cce="" />
<oval id="jboss_eap_java_security_manager_policy" />
<ref nist="SA-13" disa="" cis="" />
</Rule>

<Rule id="jboss_eap_jmx_permissions" severity="low">
<title>Ensure Permissions Are Configured For JBoss JMX Kernel MBean</title>
<description>
Java permissions for MBeans should be carefully restricted to enforce the least
privilege principle. These permissions are enforced by the Java Security
Manager and the policies it loads at startup. These permissions can be assigned
or restricted in an application-specific, granular manner.
</description>
<ocil clause="permissions are not configured correctly">
</ocil>
<rationale>
Java permissions for MBeans should be carefully restricted to enforce the least
privilege principle. A JMX MBean server might have access to sensitive
information and might be able to perform sensitive operations. JMX provides
necessary access control that identifies which clients can access that
information and who can perform those operations through the use of the Java
Security Manager (JSM). An MBean has a management interface consisting of named
and typed attributes that can be read and written, named and typed operations
that can be invoked and typed notifications that can be emitted by the MBean.
</rationale>



<xhtml:li>
java.home/lib/security/java.security
</xhtml:li>


<xhtml:li>
JBOSS_HOME/bin/security_cc.policy
</xhtml:li>


Other environments will simply load the java.security properties file by default. Additional policy files can be specified either at runtime (through run.conf or run.conf.bat) or by chaining existing policy files (policy.url.x=file:/user/application/java.policy)


Review all JSM permissions granted to MBeans. Grant statements should be limited to specific users and specific methods.


For example, permission A in the example below is allowed while permission B is not:

<xhtml:pre>
<xhtml:code>
//Permission A
grant principal javax.security.auth.x500.X500Principal "CN=Administrator,OU=JBoss,O=RedHat,L=Raleigh,ST=NC,C=US"
{
permission javax.management.MBeanPermission
"className#member[objectName]",
"invoke";
}
grant principal javax.management.remote.JMXPrincipal "guest"
{
permission javax.management.MBeanPermission "*", "queryNames";
permission javax.management.remote.SubjectDelegationPermission;

//Permission B
grant {
permission javax.management.MBeanPermission "*","invoke";
<fixtext>
The JBoss administrator must assign the most restrictive permissions possible (in accordance with the least privilege principle) for MBeans. This should be done in cooperation with system administrators, application developers and/or application documentation.
</fixtext>
<ident cce="" />
<!--oval id="jboss_eap_jmx_permissions" /-->
<ref nist="AC-6" disa="ECLP-1" cis="" />
</Rule>

<Rule id="jboss_eap_java_io_permissions" severity="medium">
<title>Ensure Permissions Are Configured For java.io.FilePermission</title>
<description>
Deployed applications must not be granted file permissions - except to those
that are dedicated to the application only. These permissions are enforced by
the Java Security Manager and the policies it loads at startup. These
permissions can be assigned or restricted in an application-specific, granular
manner.
</description>
<ocil clause="permissions are not configured correctly">
</ocil>
<rationale>
Java permissions for deployed applications should be carefully restricted to
enforce the least privilege principle. Granting unrestricted access to the host
operating system creates a large attack vector for malicious users that have
penetrated the JBoss server.
</rationale>


<xhtml:ul>
<xhtml:li>
java.home/lib/security/java.security
</xhtml:li>

<xhtml:li>
JBOSS_HOME/bin/security_cc.policy
</xhtml:li>

</xhtml:ul>


Other environments will simply load the java.security properties file by default. Additional policy files can be specified either at runtime (through run.conf or run.conf.bat) or by chaining existing policy files (policy.url.x=file:/user/application/java.policy).

Review all permissions granted to user deployed applications. The JBoss administrator must assign the most restrictive permissions possible (in accordance with the least privilege principle) for applications.
Grant statements granting file permissions are permitted only when the file permission targets are located within the user application's directory and dedicated for use by the deployed application.


For example, permission A in the example below is allowed while permission B is not:

<xhtml:pre>
<xhtml:code>
//Permission A
grant codeBase "file:${JBoss.server.home.dir}/deploy/userApplication/" {
permission java.io.FilePermission "${JBoss.server.home.dir}/deploy/userApplication/temp.txt", "read";
};
//Permission B
grant codeBase "file:${JBoss.server.home.dir}/deploy/userApplication/" {
permission java.io.FilePermission "/etc/shadown", "read";
<fixtext>

The JBoss administrator must assign the most restrictive permissions possible (in accordance with the least privilege principle) for applications. This should be done in cooperation with application developers or application documentation.

Application access granted to files by java.io.FilePermission must be located within the deployed application's directory path and be dedicated for use by the deployed application. Grant statements in conflict with this guidance should be modified or removed.

</fixtext>
<ident cce="" />
<!--oval id="jboss_eap_java_io_permissions" /-->
<ref nist="AC-6" disa="ECLP-1" cis="" />
</Rule>

<Rule id="jboss_eap_java_net_permissions" severity="medium">
<title>Ensure Permissions Are Configured For java.net.NetPermission</title>
<description>
Deployed applications must not be granted network permissions. These
permissions are enforced by the Java Security Manager and the policies it loads
at startup. These permissions can be assigned or restricted in an
application-specific, granular manner.
</description>
<ocil clause="permissions are not configured correctly">
</ocil>
<rationale>
Java permissions for deployed applications should be carefully restricted to
enforce the least privilege principle.
</rationale>



<xhtml:ul>
<xhtml:li>
java.home/lib/security/java.security
</xhtml:li>

<xhtml:li>
JBOSS_HOME/bin/security_cc.policy
</xhtml:li>

</xhtml:ul>

Other environments will simply load the java.security properties file by default. Additional policy files can be specified either at runtime (through run.conf or run.conf.bat) or by chaining existing policy files (policy.url.x=file:/user/application/java.policy).


Review all permissions granted to user deployed applications. Grant statements granting network permissions are not allowed and will look similar to the following:

<xhtml:pre>
<xhtml:code>
grant codeBase "file:${JBoss.server.home.dir}/deploy/userApplication/" {
permission java.net.NetPermission [specific permissions];
<fixtext>
The JBoss administrator must assign the most restrictive permissions possible (in accordance with the least privilege principle) for applications. This should be done in cooperation with application developers or application documentation.

Permissions granted to applications via java.net.NetPermission should be removed.

</fixtext>
<ident cce="" />
<!--oval id="jboss_eap_java_net_permissions" /-->
<ref nist="AC-6" disa="ECLP-1" cis="" />
</Rule>

<Rule id="jboss_eap_java_lang_permissions" severity="medium">
<title>Ensure Permissions Are Configured For java.lang.RuntimePermission</title>
<description>
Deployed applications must not be granted runtime permissions. These
permissions are enforced by the Java Security Manager and the policies it loads
at startup. These permissions can be assigned or restricted in an
application-specific, granular manner.
</description>
<ocil clause="permissions are not configured properly">
</ocil>
<rationale>
Java permissions for deployed applications should be carefully restricted to
enforce the least privilege principle. Granting RuntimePermission to
applications allows these applications to modify classloaders or modify the
running security manager. Either of these actions can be used to elevate
permissions and increase the number of potential damaging actions that can be
taken.
</rationale>


<xhtml:ul>
<xhtml:li>
java.home/lib/security/java.security
</xhtml:li>

<xhtml:li>
JBOSS_HOME/bin/security_cc.policy
</xhtml:li>

</xhtml:ul>

Other environments will simply load the java.security properties file by default. Additional policy files can be specified either at runtime (through run.conf or run.conf.bat) or by chaining existing policy files (policy.url.x=file:/user/application/java.policy)

Review all permissions granted to user deployed applications. Grant statements granting runtime permissions are not allowed and will look similar to the following:

<xhtml:pre>
<xhtml:code>
grant codeBase "file:${JBoss.server.home.dir}/deploy/userApplication/" {
permission java.lang.RuntimePermission [specific permissions];
<fixtext>
The JBoss administrator must assign the most restrictive permissions possible (in accordance with the least privilege principle) for applications. This should be done in cooperation with application developers or application documentation.

Permissions granted to applications via java.lang.RuntimePermission should be removed.

</fixtext>
<ident cce="" />
<!--oval id="jboss_eap_java_lang_permissions" /-->
<ref nist="AC-6" disa="ECLP-1" cis="" />
</Rule>

<Rule id="jboss_eap_java_socket_permissions" severity="medium">
<title>Ensure Permissions Are Configured For java.net.SocketPermission</title>
<description>
Deployed applications must not be granted any socket permissions. These
permissions are enforced by the Java Security Manager and the policies it loads
at startup. These permissions can be assigned or restricted in an
application-specific, granular manner.
</description>
<ocil clause="permissions are not configured properly">
</ocil>
<rationale>
Java permissions for deployed applications should be carefully restricted to
enforce the least privilege principle. Most well-designed applications will not
need to directly manipulate sockets for network access. Access to datasources
should be handled through datasources, which can be assigned SocketPermission.
</rationale>


<xhtml:ul>
<xhtml:li>
java.home/lib/security/java.security
</xhtml:li>

<xhtml:li>
JBOSS_HOME/bin/security_cc.policy
</xhtml:li>

</xhtml:ul>

Other environments will simply load the java.security properties file by default. Additional policy files can be specified either at runtime (through run.conf or run.conf.bat) or by chaining existing policy files (policy.url.x=file:/user/application/java.policy)

Review all permissions granted to user deployed applications. Grant statements granting socket permissions are not allowed and will look similar to the following:


<xhtml:pre>
<xhtml:code>
grant codeBase "file:${JBoss.server.home.dir}/deploy/userApplication/" {
permission java.net.SocketPermission [specific permissions];
<fixtext>
The JBoss administrator must assign the most restrictive permissions possible (in accordance with the least privilege principle) for applications. This should be done in cooperation with application developers or application documentation.

Permissions granted to applications via java.net.SocketPermission should be removed.

</fixtext>
<ident cce="" />
<!--oval id="jboss_eap_java_socket_permissions" /-->
<ref nist="AC-6" disa="ECLP-1" cis="" />
</Rule>

<Rule id="jboss_eap_java_security_permissions" severity="medium">
<title>Ensure Permissions Are Configured For java.security.AllPermission</title>
<description>
Deployed applications must not be granted all permissions. These permissions
are enforced by the Java Security Manager and the policies it loads at startup.
These permissions can be assigned or restricted in an application-specific,
granular manner.
</description>
<ocil clause="permissions are not configured properly">
</ocil>
<rationale>
Java permissions for deployed applications should be carefully restricted to
enforce the least privilege principle. Using AllPermissions is essentially
disabling the Java security sandbox and is inadvisable in nearly every scenario.
</rationale>


<xhtml:ul>
<xhtml:li>
java.home/lib/security/java.security
</xhtml:li>

<xhtml:li>
JBOSS_HOME/bin/security_cc.policy
</xhtml:li>

</xhtml:ul>

Additional policy files can be specified either at runtime (through run.conf or run.conf.bat) or by chaining existing policy files (policy.url.x=file:/user/application/java.policy)

Review all permissions granted to user deployed applications. Grant statements granting AllPermission are not allowed and will look similar to the following:


<xhtml:pre>
<xhtml:code>
grant codeBase "file:${JBoss.server.home.dir}/deploy/userApplication/" {
permission java.security.AllPermission;
<fixtext>
The JBoss administrator must assign the most restrictive permissions possible (in accordance with the least privilege principle) for applications. This should be done in cooperation with application developers or application documentation.

Permissions granted to applications via java.security.AllPermission should be removed.

</fixtext>
<ident cce="" />
<!--oval id="jboss_eap_java_security_permissions" /-->
<ref nist="AC-6" disa="ECLP-1" cis="" />
</Rule>

<Rule id="jboss_eap_configure_jaas_beam" severity="medium">
<title>Ensure Java Authentication and Authorization Service (JAAS) Is Enabled</title>
<description>
For JBoss Seam, the simplified Java Authentication and Authorization Service
configuration provided by the Seam Security API must not be used. The default
system JAAS configuration should be used instead. Using the default system JAAS
configuration ensures user identification and authentication are performed by
the JBoss Enterprise Application Platform. JBoss Seam provides additional
interfaces for implementing other security functions such as authorization (for
example, entity bean permissions). This functionality is controlled by JBoss
Seam, and is therefore outside the scope of the evaluated product.
</description>
<ocil clause="JAAS is not configured for use">
</ocil>
<rationale>
Using an administrator specified JAAS configuration enables a more rigorous security posture.
</rationale>



Check for components.xml. These files are typically located within the WEB-INF director of a deployed WAR. However, components.xml can also be located within the META-INF directory of a JAR or any JAR directory containing classes with a @Name annotation.
Within components.xml, the security identity should specify a JAAS security domain to override the default Seam configuration. See the example below:

<xhtml:pre>
<xhtml:code>
&lt;security:identity jaas-config-name="[security domain]"/&gt;
</xhtml:code>

</xhtml:pre>

<fixtext>
Within components.xml, the security identity should specify a JAAS security domain to override the default Seam configuration. See the example below:

<xhtml:pre>
<xhtml:code>
&lt;security:identity jaas-config-name="[security domain]"/&gt;
</xhtml:code>

</xhtml:pre>

Components.xml is typically located within the WEB-INF director of a deployed WAR. However, components.xml can also be located within the META-INF directory of a JAR or any JAR directory containing classes with a @Name annotation.

</fixtext>
<ident cce="" />
<!--oval id="jboss_eap_configure_jaas_beam" /-->
<ref nist="CM-6" disa="DCCS-1,DCCS-2,DCCT-1,ECSC-1,DCSS-1" cis="" />
</Rule>

<Rule id="jboss_eap_validate_keystore_jsm" severity="low">
<title>Validate keystore and keystorePasswordURL Properties A Loaded By Java Security Manager</title>
<description>
Ensure keystore and keystorePasswordURL properties exist and are loaded by Java
Security Manager.
</description>
<ocil clause="keystore and keystorePasswordURL properties do not exist and are not loaded by Java Security Manager">
</ocil>
<rationale>
A keystore should be setup for production environments. Defining a keystore is
a basic step towards implementing security and allowing for the use of
public/private key cryptography for JBoss. The keystore should be password
protected to protect the integrity of the keystore and prevent unauthorized
modification.
</rationale>

<xhtml:pre>
<xhtml:code>
keystore "file:[PATH TO KEYSTORE]";
keystorePasswordURL "file:[PATH TO PASSWORD FILE]";
</xhtml:code>

</xhtml:pre>

<fixtext>
Add the following lines to any loaded policy file:

<xhtml:pre>
<xhtml:code>
keystore "file:[DESIRED PATH TO KEYSTORE]";
keystorePasswordURL "file:[DESIRED PATH TO PASSWORD FILE]";
</xhtml:code>

</xhtml:pre>

A typical configuration may look like the following:

<xhtml:pre>
<xhtml:code>
keystore "file:${JBoss.server.home.dir}/cc.keystore";
keystorePasswordURL "file:${JBoss.server.home.dir}/cc.password";
</xhtml:code>

</xhtml:pre>

NOTE: The file names and paths may be different. Those shown are the defaults. If the keystore or password file are in different locations, the policy should reflect that.

</fixtext>
<ident cce="" />
<!--oval id="jboss_eap_validate_keystore_jsm" /-->
<ref nist="SC-28,IA-5" disa="ECCR-1,ECCR-2,ECCR-3,IAIA-1,IAIA-2,IATS-1,IATS-2" cis="" />
</Rule>

<Rule id="jboss_eap_validate_keystore" severity="medium">
<title>Validate Keystore For JBoss</title>
<description>
Validate a keystore for JBoss exists and is accessible to JBoss.
</description>
<ocil clause="keystore does not exist and is not configure properly">
</ocil>
<rationale>
A keystore should be setup for production environments. Defining a keystore is
a basic step towards implementing security and allowing for the use of
public/private key cryptography for JBoss. The keystore should be password
protected to protect the integrity of the keystore and prevent unauthorized
modification.
</rationale>
		
<xhtml:pre>
<xhtml:code>
keystore "file:[PATH TO KEYSTORE]";
</xhtml:code>

</xhtml:pre>

<fixtext>
To create a JBoss keystore, run the following command (you will be prompted to create a password):

<xhtml:pre>
<xhtml:code>
keytool -importcert -alias jboss -keystore [PATH TO KEYSTORE AS DEFINED IN POLICY FILE] -file [PATH TO TRUSTED CERTIFICATE TO IMPORT] -noprompt -trustcacerts
</xhtml:code>

</xhtml:pre>

Setting permissions will vary by operating system, but typically commands like cacls, xacls, chmod, setfacl, etc can all be used to restrict permissions on the keystore. Only the JBoss process owner and JBoss administrators should have READ/WRITE access to the keystore.


</fixtext>
<ident cce="" />
<!--oval id="jboss_eap_validate_keystore" /-->
<ref nist="SC-8,IA-5" disa="ECTM-1,ECTM-2,IAIA-1,IAIA-2,IATS-1,IATS-2" cis="" />
</Rule>

<Rule id="jboss_eap_validate_keystore_java" severity="medium">
<title>Validate Password File For The Java Keystore</title>
<description>
Validate a password file for the keystore defined in the properties file exists
and is accessible to JBoss.
</description>
<ocil clause="password file does not exist or is not defined">
</ocil>
<rationale>
A password-protected keystore should be setup for production environments. The
password for the keystore should be stored in a password file to facilitate
automated startup of JBoss Enterprise Application Platform.
</rationale>

<xhtml:pre>
<xhtml:code>
keystorePasswordURL "file:[PATH TO KEYSTORE PASSWORD FILE]";
</xhtml:code>

</xhtml:pre>

<fixtext>
To add a password file for a JBoss keystore, simply add the plain-text password to a file and then specify that file in a loaded Java Security Manager policy.

First, ensure the password file location is identified in the policy file being loaded by the Java Security Manager:

<xhtml:pre>
<xhtml:code>
keystorePasswordURL "file:[DESIRED PATH TO KEYSTORE PASSWORD FILE]";
</xhtml:code>

</xhtml:pre>

Next, add the plain-text password to file whose location you just defined.

Finally, restrict permissions on the password file so that only the JBoss process owner account and JBoss administrators have READ/WRITE access. Setting permissions will vary by operating system, but typically commands like cacls, xacls, chmod, setfacl, etc can all be used to restrict permissions on the keystore. Only the JBoss process owner and JBoss administrators should have READ/WRITE access to the password file.


</fixtext>
<ident cce="" />
<!--oval id="jboss_eap_validate_keystore_java" /-->
<ref nist="SC-28,IA-5" disa="ECCR-1,ECCR-2,ECCR-3,IAIA-1,IAIA-2,IATS-1,IATS-2" cis="" />
</Rule>

<Rule id="jboss_eap_validate_keystore_protected" severity="medium">
<title>Validate JBoss Keystore Password Protected</title>
<description>
Validate the keystore loaded by the Java Security Manager is password protected.
Password protecting the Java keystore used by JBoss issued to protect the
integrity of the keystore. It does not prevent listing the content, but it does
prevent modification of the keystore.  Private keys within the keystore are
still protected by their own passwords to prevent disclosure.
</description>
<ocil clause="it is not">
</ocil>
<rationale>
Failure to protect the integrity of the keystore used by JBoss can result in
authorized modification of the keystore and subsequent certificate trust
compromises for JBoss.
</rationale>

<xhtml:pre>
<xhtml:code>
keystore "file:${JBoss.server.home.dir}/cc.keystore";
</xhtml:code>

</xhtml:pre>

Next, access the contents of the keystore using the following command:

<xhtml:pre>
<xhtml:code>
keytool -list -keystore [PATH TO KEYSTORE]
</xhtml:code>

</xhtml:pre>

<fixtext>
Determine which keystore is being used by JBoss. In a default JBoss deployment the following policy file will be utilized by Java Security Manager: java.home/lib/security/java.security (Common Criteria installations are typically configured to use the JBOSS_HOME/bin/security_cc.policy file). Additional policy files can be specified either at runtime (through run.conf or run.conf.bat) or by chaining existing policy files (policy.url.x=file:/user/application/java.policy). Search for a property similar to the following:

<xhtml:pre>
<xhtml:code>
keystore "file:[PATH TO KEYSTORE]";
</xhtml:code>

</xhtml:pre>

Add a password to the keystore:

<xhtml:pre>
<xhtml:code>
keytool -storepasswd -keystore [PATH TO KEYSTORE]
</xhtml:code>

</xhtml:pre>

</fixtext>
<ident cce="" />
<!--oval id="jboss_eap_validate_keystore_protected" /-->
<ref nist="SC-28,IA-5" disa="ECCR-1,ECCR-2,ECCR-3,IAIA-1,IAIA-2,IATS-1,IATS-2" cis="" />
</Rule>

<Rule id="jboss_eap_trusted_alias" severity="low">
<title>Ensure JBoss Alias Is Trusted</title>
<description>
The jboss alias must be a trustedCertEntry with the JBoss Java keystore. This
allows code signed by with the default JBoss certificate to run when using a
restrictive policy file.
</description>
<ocil clause="it is not trusted">
</ocil>
<rationale>
A keystore should be setup for production environments with JBoss as a
trustedCertEntry for proper functioning of the JBoss Enterprise Application
Platform.
</rationale>


<xhtml:pre>
<xhtml:code>
keystore "file:${JBoss.server.home.dir}/cc.keystore";
</xhtml:code>

</xhtml:pre>

Next, list the contents of the keystore using the following command:

<xhtml:pre>
<xhtml:code>
keytool -list -keystore [PATH TO KEYSTORE]
</xhtml:code>

</xhtml:pre>

<fixtext>
To ensure the Jboss alias is a trustedCertEntry, the certificate must be imported to the keystore with the proper command:

<xhtml:pre>
<xhtml:code>
keytool -importcert -alias jboss -keystore [PATH TO KEYSTORE] -file JBOSS_HOME/bin/JBossPublicKey.RSA -noprompt -trustcacerts
</xhtml:code>

</xhtml:pre>

You can check the result with the following keytool command:

<xhtml:pre>
<xhtml:code>
keytool -list -keystore [PATH TO KEYSTORE]
</xhtml:code>

</xhtml:pre>

You should get similar results to those below:

<xhtml:pre>
<xhtml:code>
Your keystore contains 1 entry
jboss, May 17, 2012, trustedCertEntry,
Certificate fingerprint (MD5): 93:F2:F1:8B:EF:8A:E0:E3:D0:E7:69:BC:69:96:29:C1
</xhtml:code>

</xhtml:pre>


Alternatively, the Jboss public key can be added to the Java keystore:

<xhtml:pre>
<xhtml:code>
keytool -importcert -alias jboss -keystore JAVA_HOME/jre/lib/security/cacerts -storepass changeit -file JBOSS_HOME/bin/JBossPublicKey.RSA -noprompt -trustcacerts
</xhtml:code>

</xhtml:pre>

If the system Java keystore is used, the password should be changed with the following command. This may affect the functioning of other applications using the system Java keystore.

<xhtml:pre>
<xhtml:code>
keytool -storepasswd -keystore JAVA_HOME/jre/lib/security/cacerts
</xhtml:code>

</xhtml:pre>

</fixtext>
<ident cce="" />
<!--oval id="jboss_eap_trusted_alias" /-->
<ref nist="IA-5" disa="IAIA-1,IAIA-2,IATS-1,IATS-2" cis="" />
</Rule>

<Rule id="jboss_eap_dod_certificates" severity="medium">
<title>Ensure JBoss Is Configured With Valid DoD Certificates</title>
<description>
JBoss applications implementing encryption should present a valid DoD issued
X.509 certificate for purposes of identifying the server.
</description>
<ocil clause="it is not">
</ocil>
<rationale>
Establishing trust between clients and servers is an important part of
information security. Presenting a valid X.509 certificate leverages the
mutually-trusted DoD Public Key Infrastructure. Failure to present a valid DoD
certificate undermines user confidence, presents an inconsistent user experience
for security, and creates potential for abuse of trust by malicious entities.
</rationale>


<xhtml:ul>

<xhtml:li>
The certificate must match the domain name of the webserver being accessed. This can be determined by comparing the DNS name used in the browser to the DNS name on the presented certificate.
</xhtml:li>

<xhtml:li>
The certificate must not be expired. This can be determined by reviewing the expiration dates on the server's certificate.
</xhtml:li>

<xhtml:li>
The certificate must be issued by a DoD approved Certificate Authority. This can be determined by examining the issuing hierarchy of the presented certificate.  Valid Certificate Authorities can be found here: <xhtml:a href="https://crl.gds.disa.mil/">
https://crl.gds.disa.mil/
</xhtml:a>

</xhtml:li>

<xhtml:li>
The certificate must not be revoked. This can be determined by enabling revocation checking on the web browser or manually reviewing the revocation list identified by the certificate.
</xhtml:li>

<xhtml:li>
The certificate public key length must be at least 1024 bits.
</xhtml:li>


</xhtml:ul>



<fixtext>
The JBoss administrator must work with the local security manager and certificate registrar to successfully request a certificate from a DoD Certificate Authority.

Once a valid X.509 certificate has been obtained from a Certificate Authority within the DoD PKI, the certificate and associated private key can be installed in the JBoss keystore. The following example imports a PCKS12 public/private key pair into a Java Key Store.
<xhtml:pre>
<xhtml:code>
keytool -importkeystore -v -srckeystore KEYSTORE.p12 -srcstoretype PKCS12 -keystore NEW_KEYSTORE.jks
</xhtml:code>

</xhtml:pre>



The final step is to enable TLS on whichever Tomcat connector is used by the deployed application.

<xhtml:pre>
<xhtml:code>

&lt;Connector protocol=&quot;HTTP/1.1&quot; SSLEnabled=&quot;true&quot;
port=&quot;8443&quot; address=&quot;${jboss.bind.address}&quot;
scheme=&quot;https&quot; secure=&quot;true&quot; clientAuth=&quot;false&quot;
keystoreFile=&quot;${jboss.server.home.dir}/conf/NEW_KEYSTORE.jks&quot;
keystorePass=&quot;KEYSTORE_PASSWORD&quot; sslProtocol = &quot;TLS&quot; /&gt;

</xhtml:code>

</xhtml:pre>


</fixtext>
<ident cce="" />
<!--oval id="jboss_eap_dod_certificates" /-->
<ref nist="IA-5" disa="IAIA-1,IAIA-2,IATS-1,IATS-2" cis="" />
</Rule>

<Rule id="jboss_eap_dod_certificates_keystore" severity="medium">
<title>Ensure Keystore Utilizes DoD-Approved Certificate Authorities</title>
<description>
JBoss applications implementing encryption should utilize the DoD Public Key
Infrastructure.
</description>
<ocil clause="it does not">
</ocil>
<rationale>
Establishing trust between clients and servers is an important part of
information security. Validating client X.509 certificates against the DoD
Public Key Infrastructure leverages the enterprise trust system. Failure to
validate client certificates undermines the enterprise trust infrastructure and
makes the JBoss server vulnerable to trust abuse exploits.
</rationale>

<xhtml:pre>
<xhtml:code>
keystore "file:${JBoss.server.home.dir}/jboss.keystore";
</xhtml:code>

</xhtml:pre>

List the contents of the keystore using the following command:

<xhtml:pre>
<xhtml:code>
keytool -list -keystore [PATH TO KEYSTORE]
</xhtml:code>

</xhtml:pre>

<fixtext>
Download and install the DoD CA certificates. Currently, the CA certificates can be retrieved from https://crl.gds.disa.mil/.

The keys can be added to the keystore with a command similar to the following:

<xhtml:pre>
<xhtml:code>
keytool -importcert -keystore [PATH TO KEYSTORE] -storepass [KEYSTORE PASSWORD] -file [PATH TO CERTIFICATE] -noprompt -trustcacerts
</xhtml:code>

</xhtml:pre>


</fixtext>
<ident cce="" />
<!--oval id="jboss_eap_dod_certificates_keystore" /-->
<ref nist="IA-5" disa="IAIA-1,IAIA-2,IATS-1,IATS-2" cis="" />
</Rule>

<Rule id="jboss_eap_dod_certificates_application" severity="medium">
<title>Ensure Applications Utilizes DoD PKI Certificates</title>
<description>
JBoss applications implementing authentication should utilize the DoD Public Key
Infrastructure. The DoD Public Key Infrastructure is designed to use hardware
tokens such as the Common Access Card in conjunction with issued X.509
certificates. These tokens are typically protected with a PIN that unlocks
access to the private certificate stored on the token.
</description>
<ocil clause="they do not">
</ocil>
<rationale>
Leveraging the DoD Public Key Infrastructure increases the security of an
application because the DoD PKI raises the bar for exploitation of user
identities. Applications that require authentication and do not utilize PKI must
then rely on a less secure form of authentication, such as username and
password. Additionally, current DoD guidance requires the use of DoD PKI over
username and password.
</rationale>

First, determine if authentication is required by the deployed application. Review the deployed application's jboss-web.xml (JBOSS_HOME/server/[PROFILE]/deploy/[APPLICATION]/WEB-INF/) file to ensure that a security domain has been referenced. For example:

<xhtml:pre>
<xhtml:code>
&lt;security-domain&gt;java:/jaas/JBossTestRealm&lt;/security-domain&gt;
</xhtml:code>

</xhtml:pre>


Next, review the deployed application's web.xml (JBOSS_HOME/server/[PROFILE]/deploy/[APPLICATION]/WEB-INF/) file to ensure that resources within the web application have been identified to be secured. The &lt;auth-method&gt; element MUST contain CLIENT-CERT in order to implement certificate-based authentication. For example:

<xhtml:pre>
<xhtml:code>
&lt;security-constraint&gt;
&lt;web-resource-collection&gt;
&lt;web-resource-name&gt;TestResource&lt;/web-resource-name&gt;
&lt;url-pattern&gt;/*&lt;/url-pattern&gt;
&lt;/web-resource-collection&gt;
&lt;auth-constraint&gt;
&lt;role-name&gt;JBossTestRole&lt;/role-name&gt;
&lt;/auth-constraint&gt;
&lt;/security-constraint&gt;

&lt;login-config&gt;
&lt;auth-method&gt;CLIENT-CERT&lt;/auth-method&gt;
&lt;realm-name&gt;Test realm&lt;/realm-name&gt;
&lt;/login-config&gt;

&lt;security-role&gt;
&lt;role-name&gt;JBossTestRole&lt;/role-name&gt;
&lt;/security-role&gt;
</xhtml:code>

</xhtml:pre>


Next, ensure that an &lt;application-policy&gt; element is defined that matches the &lt;security-domain&gt; referenced by the jboss-web.xml file. These &lt;application-policy&gt; can be defined
in the server profile conf directory, in an application deployment descriptor, or directly deployed as an MBean.

<xhtml:ul>

<xhtml:li>
JBOSS_HOME/server/[PROFILE]/conf/login-config.xml
</xhtml:li>

<xhtml:li>
JBOSS_HOME/server/[PROFILE]/deploy/[APPLICATION]/META-INF/*-jboss-beans.xml
</xhtml:li>

<xhtml:li>
JBOSS_HOME/server/[PROFILE]/deploy/[APPLICATION]/WEB-INF/*-jboss-beans.xml
</xhtml:li>

<xhtml:li>
JBOSS_HOME/server/[PROFILE]/deploy/*-jboss-beans.xml
</xhtml:li>

</xhtml:ul>


Check the &lt;application-policy&gt; element to ensure it has modules defined for authentication. This &lt;login-module&gt; MUST contain the following attributes:
<xhtml:ul>
<xhtml:li>
code="org.jboss.security.auth.spi.BaseCertLoginModule"
</xhtml:li>
<xhtml:li>
flag="required"
</xhtml:li>

</xhtml:ul>


Example of a satisfactory element:

<xhtml:pre>
<xhtml:code>
&lt;application-policy name="JBossTestRealm"&gt;
&lt;authentication&gt;
&lt;login-module code="org.jboss.security.auth.spi.UsersRolesLoginModule" flag="required"&gt;
&lt;module-option name="usersProperties"&gt;testUsers.properties&lt;/module-option&gt;
&lt;module-option name="rolesProperties"&gt;testRoles.properties&lt;/module-option&gt;
&lt;/login-module&gt;
&lt;/authentication&gt;
&lt;/application-policy&gt;
</xhtml:code>

</xhtml:pre>

Additional modules can be included to shape the exact functionality desired.  For example, &lt;module&gt;s such as SubjectCNMapping can be included to perform attribute mapping.

Finally, the client certificate's Distinguished Name field must be mapped to a certificate alias stored in the a keystore. The keystore will be defined in the JaasSecurityDomain MBean. For example:

<xhtml:pre>
<xhtml:code>
&lt;mbean code=&quot;org.jboss.security.plugins.JaasSecurityDomain&quot; name=&quot;jboss.ch8:service=SecurityDomain&quot;&gt;
&lt;constructor&gt;
&lt;arg type=&quot;java.lang.String&quot; value=&quot;JBossTestRealm&quot;/&gt;
&lt;/constructor&gt;
&lt;attribute name=&quot;KeyStoreURL&quot;&gt;resource:localhost.keystore&lt;/attribute&gt;
&lt;attribute name=&quot;KeyStorePass&quot;&gt;cleartext-password-that-should-be-masked&lt;/attribute&gt;
<fixtext>
First, setup an &lt;application-policy&gt; that enforces certificate-based authentication.  This can be accomplished in the following files:

<xhtml:ul>

<xhtml:li>
JBOSS_HOME/server/[PROFILE]/conf/login-config.xml
</xhtml:li>

<xhtml:li>
JBOSS_HOME/server/[PROFILE]/deploy/[APPLICATION]/META-INF/*-jboss-beans.xml
</xhtml:li>

<xhtml:li>
JBOSS_HOME/server/[PROFILE]/deploy/[APPLICATION]/WEB-INF/*-jboss-beans.xml
</xhtml:li>

<xhtml:li>
JBOSS_HOME/server/[PROFILE]/deploy/*-jboss-beans.xml
</xhtml:li>

</xhtml:ul>


The &lt;application-policy&gt; should resemble the example below:

<xhtml:pre>
<xhtml:code>
&lt;application-policy name="JBossTestRealm"&gt;
&lt;authentication&gt;
&lt;login-module code="org.jboss.security.auth.spi.UsersRolesLoginModule" flag="required"&gt;
&lt;module-option name="usersProperties"&gt;testUsers.properties&lt;/module-option&gt;
&lt;module-option name="rolesProperties"&gt;testRoles.properties&lt;/module-option&gt;
&lt;/login-module&gt;
&lt;/authentication&gt;
&lt;/application-policy&gt;
</xhtml:code>

</xhtml:pre>

Next, add the &lt;application-policy&gt; to the deployment descriptors and setup the &lt;security-constraint&gt;.


JBOSS_HOME/server/[PROFILE]/deploy/[APPLICATION]/WEB-INF/jboss-web.xml

<xhtml:pre>
<xhtml:code>
&lt;security-domain&gt;java:/jaas/JBossTestRealm&lt;/security-domain&gt;
</xhtml:code>

</xhtml:pre>


JBOSS_HOME/server/[PROFILE]/deploy/[APPLICATION]/WEB-INF/web.xml

<xhtml:pre>
<xhtml:code>
&lt;security-constraint&gt;
&lt;web-resource-collection&gt;
&lt;web-resource-name&gt;TestResource&lt;/web-resource-name&gt;
&lt;url-pattern&gt;/*&lt;/url-pattern&gt;
&lt;/web-resource-collection&gt;

&lt;auth-constraint&gt;
&lt;role-name&gt;JBossTestRole&lt;/role-name&gt;
&lt;/auth-constraint&gt;
&lt;/security-constraint&gt;

&lt;login-config&gt;
&lt;auth-method&gt;CLIENT-CERT&lt;/auth-method&gt;
&lt;realm-name&gt;Test realm&lt;/realm-name&gt;
&lt;/login-config&gt;

&lt;security-role&gt;
&lt;role-name&gt;JBossTestRole&lt;/role-name&gt;
&lt;/security-role&gt;
</xhtml:code>

</xhtml:pre>


Define a keystore to be used via the JaasSecurityDomain MBean:

JBOSS_HOME/server/[PROFILE]/deploy/[APPLICATION]/jboss-service.xml:

<xhtml:pre>
<xhtml:code>
&lt;mbean code=&quot;org.jboss.security.plugins.JaasSecurityDomain&quot; name=&quot;jboss.ch8:service=SecurityDomain&quot;&gt;
&lt;constructor&gt;
&lt;arg type=&quot;java.lang.String&quot; value=&quot;JBossTestRealm&quot;/&gt;
&lt;/constructor&gt;

&lt;attribute name=&quot;KeyStoreURL&quot;&gt;resource:test.keystore&lt;/attribute&gt;
&lt;attribute name=&quot;KeyStorePass&quot;&gt;cleartext-password-that-should-be-masked&lt;/attribute&gt;
&lt;/mbean&gt;
</xhtml:code>

</xhtml:pre>
				
Finally, import the client certificates into the keystore using the keytool command. For example:

<xhtml:pre>
<xhtml:code>
keytool -importcert -alias "DN ON THE CERTIFICATE" -keystore JBOSS_HOME/server/[PROFILE]/conf/test.keystore -file [PATH TO CERTIFICATE]
</xhtml:code>

</xhtml:pre>

</fixtext>
<ident cce="" />
<!--oval id="jboss_eap_dod_certificates_application" /-->
<ref nist="IA-5" disa="IAIA-1,IAIA-2,IATS-1,IATS-2" cis="" />
</Rule>

<Rule id="jboss_eap_fips_tomcat_connectors" severity="medium">
<title>Enable FIPS 140-2 Cryptographic Modules for JBoss Tomcat Connectors</title>
<description>
While JBoss itself has no need to load FIPS compliant modules, the underlying
technologies such as Java and the Apache Tomcat webcontainer do. Utilizing only
FIPS compliant modules decreases compatibility with applications that are not
FIPS enabled.
</description>
<ocil clause="FIPS is not enabled">
</ocil>
<rationale>
Enabling FIPS compliant algorithms ensures that the underlying technologies 
that JBoss works through are using cryptographic modules that have been vetted
by NIST for security, stability, and strength. Failure to utilize FIPS certified
modules may cause the underlying technologies used by JBoss to utilize older,
less secure algorithms. Failure to enable only FIPS compliant modules may also
have regulatory consequences, as FIPS 140-2 requires the use of FIPS compliant
modules by all federal agencies.
</rationale>
				
<fixtext>

</fixtext>
<ident cce="" />
<!--oval id="jboss_eap_fips_tomcat_connectors" /-->
<ref nist="SC-13" disa="DCNR-1,ECCR-1,ECCR-2,ECCR-3,ECCT-1,ECCT-2,ECNK-1,ECNK-2" cis="" />
</Rule>

<Rule id="jboss_eap_fips_java_environment" severity="medium">
<title>Enable FIPS 140-2 Cryptographic Modules for JBoss Java Environment</title>
<description>
While JBoss itself has no need to load FIPS compliant modules, the underlying
technologies such as Java and the Apache Tomcat webcontainer do. Utilizing only
FIPS compliant modules decreases compatibility with applications that are not
FIPS enabled.
</description>
<ocil clause="FIPS is not enabled">
</ocil>
<rationale>
Enabling FIPS compliant algorithms ensures that the underlying technologies that
JBoss works through are using cryptographic modules that have been vetted by
NIST for security, stability, and strength. Failure to utilize FIPS certified
modules may cause the underlying technologies used by JBoss to utilize older,
less secure algorithms. Failure to enable only FIPS compliant modules may also
have regulatory consequences, as FIPS 140-2 requires the use of FIPS compliant
modules by all federal agencies.
</rationale>
				
For IBM JRE/JDK 6.x:

Check for the following provider in the JAVA_HOME/jre/lib/security/java.security file:

<xhtml:ul>
<xhtml:li>
security.provider.1=com.ibm.crypto.fips.provider.IBMJCEFIPS
</xhtml:li>

</xhtml:ul>


NOTE: The FIPS compliant provider MUST be at the top of the list as #1.

Ensure the following line exists in the System.Defaults properties file:
<xhtml:ul>
<xhtml:li>
com.ibm.jsse2.usefipsprovider=true
</xhtml:li>

</xhtml:ul>


Finally, ensure the following two properties are defined in JAVA_HOME/jre/lib/security/java.security:
<xhtml:ul>
<xhtml:li>
ssl.SocketFactory.provider=com.ibm.jsse2.SSLSocketFactoryImpl
</xhtml:li>
<xhtml:li>
ssl.ServerSocketFactory.provider=com.ibm.jsse2.SSLServerSocketFactoryImpl
</xhtml:li>

</xhtml:ul>


For Sun JRE/JDK 6.x:

Check for the following providers in the JAVA_HOME/jre/lib/security/java.security file:

<xhtml:ul>
<xhtml:li>
security.provider.1=com.sun.net.ssl.internal.ssl.Provider SunPKCS11-NSS
</xhtml:li>

</xhtml:ul>


NOTE: The FIPS compliant provider MUST be at the top of the list as #1

Next, review the application source code to ensure that the proper constructors are utilized for FIPS compliant algorithms. Review the constructor used to initialize SunJSSE and ensure that the FIPS compliant mode has been enabled.


</xhtml:li>

<xhtml:li>
Lastly, perform a packet capture of the TLS handshake to ensure that only FIPS 140-2 algorithms are selected by the server (ServerHello message).
</xhtml:li>


</xhtml:ol>

<fixtext>
As this check is not specific to JBoss, validation steps will vary dependent on the Java vendor in use.

For IBM JRE/JDK 6.x:

Add the following provider to the JAVA_HOME/jre/lib/security/java.security file:

<xhtml:ul>
<xhtml:li>
security.provider.1=com.ibm.crypto.fips.provider.IBMJCEFIPS
</xhtml:li>

</xhtml:ul>


NOTE: There will be a list of several providers already in place, numbered 1 to X.  The FIPS compliant providers MUST go at the top of the list as #1 and #2.  The other providers must be re-numbered.

Ensure the following line exists in the System.Defaults properties file:
<xhtml:ul>
<xhtml:li>
com.ibm.jsse2.usefipsprovider=true
</xhtml:li>

</xhtml:ul>


Finally, ensure the following two properties are defined in JAVA_HOME/jre/lib/security/java.security:
<xhtml:ul>
<xhtml:li>
ssl.SocketFactory.provider=com.ibm.jsse2.SSLSocketFactoryImpl
</xhtml:li>
<xhtml:li>
ssl.ServerSocketFactory.provider=com.ibm.jsse2.SSLServerSocketFactoryImpl
</xhtml:li>

</xhtml:ul>


For Sun JRE/JDK 6.x:

Add the following provider to the JAVA_HOME/jre/lib/security/java.security file:

<xhtml:ul>
<xhtml:li>
security.provider.1=com.sun.net.ssl.internal.ssl.Provider SunPKCS11-NSS
</xhtml:li>

</xhtml:ul>


NOTE: There will be a list of several providers already in place, numbered 1 to X.  The FIPS compliant provider MUST go at the top of the list as #1.  The other providers must be re-numbered.

Now the deployed applications must be written to take advantage of the FIPS enabled providers. The Sun SunJSSE provider must be initialized at run-time with the FIPS boolean value as true.

</fixtext>
<ident cce="" />
<!--oval id="jboss_eap_fips_tomcat_connectors" /-->
<ref nist="SC-13" disa="DCNR-1,ECCR-1,ECCR-2,ECCR-3,ECCT-1,ECCT-2,ECNK-1,ECNK-2" cis="" />
</Rule>

<Rule id="jboss_eap_remove_cleartext_passwords" severity="medium">
<title>Remove Clear-Text Passwords from Data Sources</title>
<description>
Eliminate clear-text passwords in data source configuration files. The class
org.jboss.resource.security.SecureIdentityLoginModule can be used to both
encrypt database passwords and to provide a decrypted version of the password
when the data source configuration is required by the server. The
SecureIdentityLoginModule uses a hard-coded password to encrypt/decrypt the
data source password.
</description>
<ocil clause="clear-text passwords exist and are not removed">
</ocil>
<rationale>
Clear-text passwords are an unnecessary security vulnerability. While risk of
exposure can be mitigated through configured permissions and file ownership,
these methods do not completely remediate the risk.
</rationale>
		
<fixtext>
Following the extensive instructions located within Chapter 17, "Encrypting Data Source Passwords" of the JBoss Enterprise Application Platform 5 Security Guide, 2011. While too lengthy to contain here, the summarized steps include:

<xhtml:ul>
<xhtml:li>
Encrypt the data source password.
</xhtml:li>

<xhtml:li>
Create an application authentication policy with the encrypted password.
</xhtml:li>

<xhtml:li>
Configure the data source to use the application authentication policy.
</xhtml:li>

</xhtml:ul>

</fixtext>
<ident cce="" />
<!--oval id="jboss_eap_remove_cleartext_passwords" /-->
<ref nist="SC-28" disa="ECCR-1,ECCR-2,ECCR-3" cis="" />
</Rule>

<Rule id="jboss_eap_remove_cleartext_passwords_tomcat" severity="medium">
<title>Remove Clear-Text Passwords from Tomcat Connectors</title>
<description>
Eliminate clear-text passwords in Tomcat Connectors.
</description>
<ocil clause="clear-text passwords exist and are not removed">
</ocil>
<rationale>
Clear-text passwords are an unnecessary security vulnerability. While risk of
exposure can be mitigated through configured permissions and file ownership,
these methods do not completely remediate the risk.
</rationale>

<fixtext>
Following the extensive instructions located within Chapter 18, "Encrypting the Keystore Password in a Tomcat Connector" of the JBoss Enterprise Application Platform 5 Security Guide, 2011. While too lengthy to contain here, the summarized steps include:

<xhtml:ul>
<xhtml:li>
Configure JaasSecurityDomain MBean
</xhtml:li>

<xhtml:li>
Generate encrypted password
</xhtml:li>

<xhtml:li>
Update the Tomcat service MBean
</xhtml:li>

</xhtml:ul>

</fixtext>
<ident cce="" />
<!--oval id="jboss_eap_remove_cleartext_passwords_tomcat" /-->
<ref nist="SC-28" disa="ECCR-1,ECCR-2,ECCR-3" cis="" />
</Rule>

<Rule id="jboss_eap_remove_cleartext_passwords_xml" severity="medium">
<title>Remove Clear-Text Passwords from XML Configuration Files</title>
<description>
Using password masking, eliminate clear-text passwords in XML configuration
files.
</description>
<ocil clause="clear-text passwords exist and are not removed">
</ocil>
<rationale>
Clear-text passwords are an unnecessary security vulnerability. While risk of
exposure can be mitigated through configured permissions and file ownership,
these methods do not completely remediate the risk.
</rationale>

<fixtext>
Follow the extensive instructions located within Chapter 16, "Masking Passwords in XML Configuration" of the JBoss Enterprise Application Platform 5 Security Guide, 2011. These instructions are too lengthy to summarize here.

</fixtext>
<ident cce="" />
<!--oval id="jboss_eap_remove_cleartext_passwords_xml" /-->
<ref nist="SC-28" disa="ECCR-1,ECCR-2,ECCR-3" cis="" />
</Rule>

<Rule id="jboss_eap_jmm_default_password" severity="high">
<title>Change the Default Password for the JBoss Messaging MessageSucker</title>
<description>
JBoss Messaging ships with a default MessageSucker password located within the
Messaging ServerPeer configuration. This password is used by JBoss to create
connections and pass messages between nodes.
</description>
<ocil clause="it is not changed">
</ocil>
<rationale>
The SuckerPassword ships with a default clear-text password that can be used by
attackers to pass messages to default installations of Jboss. The exact content
and ramifications of these messages will depend on the listening applications
(application logic, input validations, etc.). Failure to change this password
can allow an attacker to create connections and pass messages to nodes.
</rationale>


JBOSS_HOME/server[PROFILE]/deploy/messaging/messaging-jboss-beans.xml

<fixtext>
Open the Jboss Messaging configuration file for the Messaging ServerPeer located here:


JBOSS_HOME/server[PROFILE]/deploy/messaging/messaging-jboss-beans.xml

Locate the element &lt;property name="suckerPassword" &gt; and change the contents to a new password generated in accordance with your organization's password security requirements, restricting the use of predefined XML entities such as &lt;'&gt;@" or escaping them if you do. For example:


&lt;property name="suckerPassword" &gt;Lmf3SdntiDFF6(D5&lt;/property&gt;


The encrypted version of this password can be added to JBOSS_HOME/server[PROFILE]/deploy/messaging/messaging-service.xml by following the directions located in Follow the extensive instructions located within Chapter 16, "Masking Passwords in XML Configuration" of the JBoss Enterprise Application Platform 5 Security Guide, 2011.

</fixtext>
<ident cce="" />
<!--oval id="jboss_eap_jmm_default_password" /-->
<ref nist="IA-5" disa="IAIA-1,IAIA-2,IATS-1,IATS-2" cis="" />
</Rule>

<Rule id="jboss_eap_keystore_default_password" severity="low">
<title>Change Default Password for Java CA Keystore</title>
<description>
The Java cacerts keystore is installed by default with most versions of Java. It
contains X.509 public certificates for a set of default commercial Certificate
Authorities.
</description>
<ocil clause="it is not changed">
</ocil>
<rationale>
To prevent compromise of the server's X.509 trust chains, the well-known default
password on the cacerts keystore should be changed. Failure to change this
password could lead to the malicious modification of trusted X.509 CA's.
This would allow attackers to create connections as trusted entities, sign
malicious could as a trusted entity, or create any other number of X.509
certificate abuses.
</rationale>

<xhtml:pre>
<xhtml:code>
keytool -list -keystore JAVA_HOME/lib/security/cacerts
</xhtml:code>

</xhtml:pre>

If the cacerts file cannot be found in your JAVA_HOME/lib/security/, try searching the system for the file named cacerts located in the Java install path.

You should be prompted for a password (non-blank). Attempt to authenticate using the default password 'changeit'

If you fail to authenticate, you will receive a warning message (and the contents of the keystore will still be displayed):

***************** WARNING WARNING WARNING *****************

* The integrity of the information stored in your keystore *

* has NOT been verified! In order to verify its integrity, *

* you must provide your keystore password.         *

***************** WARNING WARNING WARNING *****************

Using the default password 'changeit' should fail to authenticate and thus produce the warning. If the default password successfully authenticates, this check fails.

<fixtext>
Add a password to the default Java cacerts keystore:

<xhtml:pre>
<xhtml:code>
keytool -storepasswd -keystore [PATH TO KEYSTORE]
</xhtml:code>

</xhtml:pre>


</fixtext>
<ident cce="" />
<!--oval id="jboss_eap_keystore_default_password" /-->
<ref nist="IA-5" disa="IAIA-1,IAIA-2,IATS-1,IATS-2" cis="" />
</Rule>

<Rule id="jboss_eap_enable_audit_appender" severity="medium">
<title>Ensure Security Audit Appender Is Enabled</title>
<description>
The Security Audit Appender must be enabled. The Security Audit Appender and the
Security Audit Provider category together set up the audit infrastructure that
allows deployed applications to easily audit authentication and authorization
events.
</description>
<ocil clause="it is not enabled">
</ocil>
<rationale>
Enabling the Security Audit Appender is a necessary component of comprehensive
auditing in a secure production environment.
</rationale>

<fixtext>
Ensure the Security Audit Appender is defined within JBOSS_HOME/server/[PROFILE]/conf/jboss-log4j.xml. By default, the Security Audit Appender exists and just needs to be uncommented.

<xhtml:pre>
<xhtml:code>
&lt;!-- Security AUDIT Appender --&gt;
&lt;appender name="AUDIT" class="org.jboss.logging.appender.DailyRollingFileAppender"&gt;
&lt;errorHandler class="org.jboss.logging.util.OnlyOnceErrorHandler"/&gt;
&lt;param name="File" value="${JBoss.server.log.dir}/audit.log"/&gt;
&lt;param name="Append" value="true"/&gt;
&lt;param name="DatePattern" value="'.'yyyy-MM-dd"/&gt;
&lt;layout class="org.apache.log4j.PatternLayout"&gt;
&lt;param name="ConversionPattern" value="%d %-5p [%c] (%t:%x) %m%n"/&gt;
&lt;/layout&gt;
&lt;/appender&gt;
</xhtml:code>

</xhtml:pre>


</fixtext>
<ident cce="" />
<oval id="jboss_eap_enable_audit_appender" />
<ref nist="AU-12" disa="ECAT-1,ECAT-2" cis="" />
</Rule>

<Rule id="jboss_eap_enable_audit_provider" severity="medium">
<title>Ensure Security Audit Provider Is Enabled</title>
<description>
The Security Audit Provider category must be enabled for production
environments. The Security Audit Appender and the Security Audit Provider
category together set up the audit infrastructure that allows deployed
applications to easily audit authentication and authorization events.
</description>
<ocil clause="it is not enabled">
</ocil>
<rationale>
Enabling the Security Audit Provider category is a necessary component of
comprehensive auditing in a secure production environment.
</rationale>

<fixtext>
Ensure the Security Audit Provider category is defined within JBOSS_HOME/server/[PROFILE]/conf/jboss-log4j.xml. By default, the Security Audit Provider category exists and just needs to be uncommented.

<xhtml:pre>
<xhtml:code>
&lt;!-- Category specifically for Security Audit Provider --&gt;
&lt;category name="org.jboss.security.audit.providers.LogAuditProvider" additivity="false"&gt;
&lt;priority value="TRACE"/&gt;
&lt;appender-ref ref="AUDIT"/&gt;
&lt;/category&gt;
</xhtml:code>

</xhtml:pre>


</fixtext>
<ident cce="" />
<oval id="jboss_eap_enable_audit_provider" />
<ref nist="AU-12" disa="ECAT-1,ECAT-2" cis="" />
</Rule>

<Rule id="jboss_eap_configure_security_logging" severity="medium">
<title>Ensure the SecurityInterceptor Logging Level Is Set Correctly</title>
<description>
Production environments of JBoss require enhanced auditing on the
SecurityInterceptor class.
</description>
<ocil clause="it is not">
</ocil>
<rationale>
Enabling TRACE priority logging on the SecurityInterceptor class is a necessary
component of comprehensive auditing in a secure production environment.
</rationale>
	
<fixtext>
Ensure a category is defined for SecurityInterceptor class with a priority of TRACE within JBOSS_HOME/server/[PROFILE]/conf/jboss-log4j.xml.

<xhtml:pre>
<xhtml:code>
&lt;category name="org.jboss.ejb.plugins.SecurityInterceptor"&gt;
&lt;priority value="TRACE" /&gt;
&lt;appender-ref ref="AUDIT" /&gt;
&lt;/category&gt;
</xhtml:code>

</xhtml:pre>


</fixtext>
<ident cce="" />
<oval id="jboss_eap_configure_security_logging" />
<ref nist="AU-12" disa="ECAT-1,ECAT-2" cis="" />
</Rule>

<Rule id="jboss_eap_configure_microcontainer_logging" severity="medium">
<title>Ensure the Microcontainer Logging Level Is Set Correctly</title>
<description>
Production environments of JBoss require auditing for Microcontainer bootstrap
operations.
</description>
<ocil clause="it is not">
</ocil>
<rationale>
Logging Microcontainer bootstrap operations is a necessary component of
comprehensive auditing in a secure production environment.
</rationale>

<fixtext>
Set the priority and appender-ref levels for the Microcontainer bootstrap by adding the &lt;category&gt; block as specified to JBOSS_HOME/server/[PROFILE]/conf/jboss-log4j.xml.

<xhtml:pre>
<xhtml:code>
&lt;category name="org.jboss.bootstrap.microcontainer"&gt;
&lt;priority value="INFO"/&gt;
&lt;appender-ref ref="AUDIT"/&gt;
&lt;/category&gt;
</xhtml:code>

</xhtml:pre>


</fixtext>
<ident cce="" />
<!--oval id="jboss_eap_configure_microcontainer_logging" /-->
<ref nist="AU-3,AU-12" disa="ECAR-1,ECAR-2,ECAR-3,ECLC-1,ECAT-1,ECAT-2" cis="" />
</Rule>

<Rule id="jboss_eap_ensure_logging_requests" severity="medium">
<title>Ensure Logging Is Enabled For Web-based Requests</title>
<description>
In the event that application requirements dictate additional logging for
web-based requests, the AccessLogValve should be enabled.
</description>
<ocil clause="it is not">
</ocil>
<rationale>
If application owners determine that additional logging of web-based requests
is desired, it should be enabled.
</rationale>



If logging of web-based requests has been required for deployed applications the AccessLogValve should be enabled. To check the status of the &lt;Valve&gt;, ensure the following element is defined within JBOSS_HOME/server/[PROFILE]/deploy/jbossweb.sar/server.xml.


<fixtext>

Ensure the following &lt;Valve&gt; exists within: JBOSS_HOME/server/[PROFILE]/deploy/jbossweb.sar/server.xml. By default, this &lt;Valve&gt; simply needs to be uncommented.

<xhtml:pre>
<xhtml:code>
&lt;Valve className="org.apache.catalina.valves.AccessLogValve" prefix="localhost_access_log." suffix=".log" pattern="common" directory="${JBoss.server.home.dir}/log" resolveHosts="false" /&gt;
</xhtml:code>

</xhtml:pre>



</fixtext>
<ident cce="" />
<!--oval id="jboss_eap_ensure_logging_requests" /-->
<ref nist="AU-3,AU-12" disa="ECAR-1,ECAR-2,ECAR-3,ECLC-1,ECAT-1,ECAT-2" cis="" />
</Rule>

<Rule id="jboss_eap_audit_appender_information" severity="low">
<title>Ensure Security Audit Appender Logs All Information</title>
<description>
The Security Audit Appender must log all identified information.
Ensure all required information is displayed in &lt;layout&gt;.
</description>
<ocil clause="it does not">
</ocil>
<rationale>
Logging full event information to the Security Audit Appender is a necessary
component of comprehensive auditing in a secure production environment.
</rationale>

<fixtext>

Enable server startup and shutdown events by making the following change to JBOSS_HOME/server/[PROFILE]/conf/jboss-log4j.xml. Update the ConversionPattern parameter in the Security Audit Appender to show thread information by replacing the default ConversionPattern with the pattern below:

<xhtml:pre>
<xhtml:code>
&lt;!--The full pattern: Date MS Priority [Category] (Thread:NDC) Message --&gt;
&lt;layout class="org.apache.log4j.PatternLayout"&gt;
&lt;param name="ConversionPattern" value="%d %-5r %-5p [%c] (%t:%x) %m%n"/&gt;
&lt;/layout&gt;
</xhtml:code>

</xhtml:pre>


</fixtext>
<ident cce="" />
<oval id="jboss_eap_audit_appender_information" />
<ref nist="AU-12" disa="ECAT-1,ECAT-2" cis="" />
</Rule>

<Rule id="jboss_eap_disable_console_logging" severity="low">
<title>Disable Console Output To The JBoss console</title>
<description>
Turn off console logging in production. Console logging in a production
environment is a needless drain on system resources.
</description>
<ocil clause="it is not disabled">
</ocil>
<rationale>
Logging to console is a potentially resource intensive activity that should be
disabled in production environments. Additionally, disabling console logging
removes a potential source of information leakage.
</rationale>
			
<fixtext>
In order to prevent JBoss from logging to console, open the JBOSS_HOME/server/[PROFILE]/conf/jboss-log4j.xml file. Next, remove or comment out the &lt;appender-ref&gt; element with a ref attribute value of 'CONSOLE'. This &lt;appender-ref&gt; element will be a child of the &lt;root&gt; element, typically located near the end of the document.

<xhtml:pre>
<xhtml:code>
&lt;root&gt;
&lt;!--Set the root logger priority via a system property. Note this is parsed by log4j,
so the full JBoss system property format is not supported; e.g.
setting a default via ${jboss.server.log.threshold:WARN} will not work.--&gt;
&lt;priority value="${jboss.server.log.threshold}"/&gt;
&lt;!-- appender-ref ref="CONSOLE"/ --&gt;
&lt;appender-ref ref="ASYNC"/&gt;
&lt;/root&gt;
</xhtml:code>

</xhtml:pre>

</fixtext>
<ident cce="" />
<oval id="jboss_eap_disable_console_logging" />
<ref nist="AU-9" disa="ECTB-1,ECTP-1" cis="" />
</Rule>

<Rule id="jboss_eap_process_least_privilege" severity="medium">
<title>Ensure JBoss Process Owner Is Executing With Least Privilege</title>
<description>
Operating environment permissions assigned to the JBoss process owner should be
in compliance with the principle of least privilege.
</description>
<ocil clause="it is not">
</ocil>
<rationale>
In order to reduce the potential impact of exploitation against the JBoss
application server (and the rest of the operating environment), the JBoss
process owner should execute with as few permissions as possible in the
environment (if the account is not local to the operating system or is
distributed across multiple operating systems). Failure to limit permissions
can dramatically increase the severity of exploits against the JBoss server,
such as the execution of arbitrary code.
</rationale>

Next, work with the JBoss administrator to identify the permissions the JBoss process owner executes with. This procedure will vary based on the host operating system. On Red Hat or Linux systems, check the group membership for the account. On Windows systems, review the User Rights Assignments within the Local Security Policy console (secpol.msc).

This check fails if the JBoss process owner is not executing with least privileges. The following list identifies common scenario failures:


<xhtml:ul>

<xhtml:li>
The JBoss process owner is a privileged account such as root or administrator.
</xhtml:li>

<xhtml:li>
The JBoss process owner is a member of a privileged group, such wheel, root, administrators, power users, domain admins, backup operators, etc.
</xhtml:li>

<xhtml:li>
The JBoss process owner is used by multiple applications via use of username and password or group membership.
</xhtml:li>

<xhtml:li>
The JBoss process owner account has unnecessary network access to other operating systems or other network nodes, typically through the use of a directory based account with no logon restrictions.
</xhtml:li>


</xhtml:ul>



<fixtext>
Steps for implementing this configuration will vary dependent upon operating system. On Red Hat or Linux systems, use /etc/group and /etc/passwd to assign the JBoss process owner a unique local account and group (and limit its group membership). Windows systems can create local accounts through the Computer Management console (compmgmt.msc) and User Rights Assignments managed through the Local Security Policy console (secpol.msc)..



</fixtext>
<ident cce="" />
<!--oval id="jboss_eap_process_least_privilege" /-->
<ref nist="AC-6" disa="ECLP-1" cis="" />
</Rule>

<Rule id="jboss_eap_deny_console_access" severity="medium">
<title>Deny the JBoss Process Owner Console Access</title>
<description>
The JBoss Application Server process owner should not have interactive console
login access.
</description>
<ocil clause="it is not denied access to the console">
</ocil>
<rationale>
In order to limit access in the event of an exploitation of the Jboss or one of
its deployed applications, the account owning the Jboss process should be
limited in its ability to interact with the supporting operating system where
possible. Thus, the JBoss process owner account should not have interactive
console access.
</rationale>

Red Hat Enterprise Linux: Interview JBoss administrators or review running processes with ps to identify the JBoss process owner account. Next, review the /etc/passwd file to ensure that the JBoss process owner account is not assigned a login shell (the shell field should read /sbin/nologin).

<fixtext>
Steps for implementing this configuration will vary, dependent upon operating system:

Red Hat Enterprise Linux: To prevent users from gaining interactive access to the system console, simply ensure that they are assigned no shell interpreter via the /etc/passwd file. For instance, a properly configured passwd entry for the JBoss account owner may resemble this:

<xhtml:pre>
<xhtml:code>
jboss:x:494:494:JBossAS:/var/lib/jbossas:/sbin/nologin
</xhtml:code>

</xhtml:pre>


</fixtext>
<ident cce="" />
<!--oval id="jboss_eap_deny_console_access" /-->
<ref nist="AC-6" disa="" cis="" />
</Rule>

<Rule id="jboss_eap_configure_file_ownership" severity="medium">
<title>Ensure JBoss File Ownership Is Set Correctly</title>
<description>
All JBoss Enterprise Application Platform files within JBOSS_HOME should be
owned by the JBoss process owner account.
</description>
<ocil clause="it is not">
</ocil>
<rationale>
To prevent unauthorized modification or disclosure of JBoss configuration
settings, all files within JBOSS_HOME should be owned by the JBoss process
owner account.
</rationale>

Use the ls command to ensure the JBoss process owner owns all JBoss configuration files (JBOSS_HOME and subdirectories); JBoss administrators should be the group owners.

<fixtext>
Steps for implementing this configuration will vary, dependent upon operating system.

On Red Hat and Linux, use chown to ensure the JBoss process owner owns all JBoss configuration files (JBOSS_HOME and subdirectories); JBoss administrators may be the group owners.

Windows environments can use the explorer GUI or cacls/xcacls to ensure the JBoss process owner owns all JBoss configuration files (JBOSS_HOME and subdirectories).


</fixtext>
<ident cce="" />
<!--oval id="jboss_eap_configure_file_ownership" /-->
<ref nist="AC-3" disa="ECAN-1,ECCD-1,ECCD-2,ECCR-2,ECIC-1,ECAN-1" cis="" />
</Rule>

<Rule id="jboss_eap_configure_file_permissions" severity="medium">
<title>Ensure JBoss File Permissions Are Set Correctly</title>
<description>
All JBoss Enterprise Application Platform files within JBOSS_HOME should be
readable by the JBoss Application Server process owner and JBoss administrators
only.
</description>
<ocil clause="it is not">
</ocil>
<rationale>
To prevent unauthorized modification or disclosure of JBoss configuration
settings, access to all JBoss related files within JBOSS_HOME should be
restricted to the JBoss process owner and JBoss administrators.
</rationale>

Red Hat Enterprise Linux: Use the ls command to check basic file permissions. The getfacl command can be useful as well.

<fixtext>
Steps for implementing this configuration will vary, dependent upon operating system.

Red Hat Enterprise Linux: Use chmod to restrict permissions on files to at least 660 for all files in JBOSS_HOME and subdirectories.

Windows environments can use the explorer GUI or cacls/xcacls to restrict permissions for all files in JBOSS_HOME and subdirectories.

File permissions should be restricted to READ/WRITE for JBoss process owner and JBoss administrators. Other accounts that may require READ access include version control accounts or process owners for backup software.

</fixtext>
<ident cce="" />
<!--oval id="jboss_eap_configure_file_permissions" /-->
<ref nist="AC-3,AC-6" disa="ECAN-1,ECCD-1,ECCD-2,ECCR-2,ECIC-1,ECAN-1,ECLP-1" cis="" />
</Rule>

</Group>
