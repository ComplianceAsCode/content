# platform = multi_platform_all
# reboot = false
# strategy = configure
# complexity = low
# disruption = medium

- name: "Get nfs and nfs4 mount points, that don't have noexec option"
  shell: grep -E "[[:space:]]nfs[4]?[[:space:]]" /etc/fstab | grep -v "noexec" | awk '{print $2}'
  register: no_noexec_points_register
  check_mode: no
  tags:
    @ANSIBLE_TAGS@

- name: "Add noexec to mount points"
  shell: awk '$2=="{{ item }}"{$4=$4",noexec"}1' /etc/fstab > fstab.tmp && mv fstab.tmp /etc/fstab
  with_items:
    - "{{ no_noexec_points_register.stdout_lines }}"
  tags:
    @ANSIBLE_TAGS@
