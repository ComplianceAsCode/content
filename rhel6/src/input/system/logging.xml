<Group id="logging">
<title>Configure Syslog</title>
<description>The syslog service has been the default Unix logging mechanism for
many years. It has a number of downsides, including inconsistent log format,
lack of authentication for received messages, and lack of authentication,
encryption, or reliable transport for messages sent over a network. However,
due to its long history, syslog is an accepted standard which is supported by
almost all Unix applications.
<br/>
<br/>
In RHEL 6, rsyslog has replaced ksyslogd as the
syslog daemon of choice, and it includes some additional security features
such as reliable, connection-oriented (i.e. TCP) transmission of logs, the
option to log to database formats, and the encryption of log data en route to
a central logging server.
This section discusses how to configure rsyslog for
best effect, and how to use tools provided with the system to maintain and
monitor logs.</description>

<Rule id="package_rsyslog_installed">
<title>Ensure rsyslog is Installed</title>
<description>
Rsyslog is installed by default. Ensure that it is installed
by running:
<pre>$ rpm -q rsyslog</pre>
If it is not installed, install it by running:
<pre># yum install rsyslog</pre>
</description>
<rationale>
The rsyslog package provides the rsyslog daemon, which provides
system logging services.
</rationale>
<ident cce="17742-8" />
<oval id="package_rsyslog_installed" />
<ref nist="AU-2, AU-9, CM-6" />
</Rule>


<Rule id="service_rsyslog_enabled">
<title>Enable Rsyslog Daemon (rsyslog)</title>
<description>The <tt>rsyslog</tt> service provides syslog-style logging by default on RHEL 6. 
The <tt>rsyslog</tt> service can be activated with the following command:
<pre># chkconfig rsyslog on</pre>
</description>
<rationale>The <tt>rsyslog</tt> service must be running in order to provide
logging services, which are essential to system administration.
</rationale>
<ident cce="17698-2" />
<oval id="service_rsyslog_enabled" />
<ref nist="AU-12, CM-6" />
</Rule>


<Group id="ensure_rsyslog_messages_captured">
<title> Ensure Important Messages are Captured</title>
<description>
Edit the file <tt>/etc/rsyslog.conf</tt>. Add or correct whichever of the following lines are appropriate for your
environment:
<pre>
auth.*,user.*                                                           /var/log/messages
kern.*                                                                  /var/log/kern.log
daemon.*                                                                /var/log/daemon.log
syslog.*                                                                /var/log/syslog
lpr,news,uucp,local0,local1,local2,local3,local4,local5,local6.*        /var/log/unused.log
</pre>
See the man page <tt>rsyslog.conf(5)</tt> for more information.
<i>By default,</i> <tt>rsyslog</tt> <i>uses a timestamp format that Logwatch does not understand. If your en-
vironment uses Logwatch, edit the file <tt>/etc/rsyslog.conf</tt> and add or edit the following line:</i>
<pre>$ ActionFileDefaultTemplate RSYSLOG_TraditionalFileFormat</pre></description>
</Group>

<Group id="log_file_permissions">
<title>Confirm Existence and Permissions of System Log Files</title>
<description>For each log file LOGFILE referenced in
<tt>/etc/rsyslog.conf</tt>, run the commands:
<pre># touch LOGFILE
# chown root:root LOGFILE
# chmod 0600 LOGFILE</pre>
Rsyslog will refuse to log to a file which does not exist.
All messages intended for that file will be silently discarded, so
it is important to verify that all log files exist. Some logs may
contain sensitive information, so it is better to restrict
permissions so that only administrative users can read or write
logfiles.</description>

<Value id="file_owner_logfiles_value" type="string"
operator="equals" interactive="0">
<title>User who owns log files</title>
<description>Specify user owner of all logfiles specified in
<tt>/etc/rsyslog.conf</tt>.</description>
<value selector="root">root</value>
</Value>

<Value id="file_groupowner_logfiles_value" type="string"
operator="equals" interactive="0">
<title>group who owns log files</title>
<description>Specify group owner of all logfiles specified in
<tt>/etc/rsyslog.conf.</tt></description>
<value selector="root">root</value>
</Value>

<Rule id="userowner_rsyslog_files">
<title>RSyslog Log Files Owned By Appropriate User</title>
<description>All <tt>rsyslog</tt> log files should be owned by the
appropriate user.</description>
<rationale>The log files generated by rsyslog contain valuable information regarding system
configuration, user authentication, and other such information. Log files should be
protected from unauthorized access.</rationale>
<ident cce="17857-4" />
<oval id="rsyslog_files_ownership" />
<ref nist="AC-3, CM-6" />
</Rule>

<Rule id="groupowner_rsyslog_files">
<title>RSyslog Log Files Owned By Appropriate Group</title>
<description>All <tt>rsyslog</tt> log files should be owned by the
appropriate group.</description>
<rationale>The log files generated by rsyslog contain valuable information regarding system
configuration, user authentication, and other such information. Log files should be
protected from unauthorized access.</rationale>
<ident cce="18240-2" />
<oval id="rsyslog_files_groupownership" />
<ref nist="AC-3, CM-6" />
</Rule>


<Rule id="rsyslog_file_permissions">
<title>RSyslog Log Files Have Correct Permissions</title>
<description>File permissions for all <tt>rsyslog</tt> log files should be
set correctly.</description>
<rationale>The log files generated by rsyslog contain valuable information regarding system
configuration, user authentication, and other such information. Log files should be
protected from unauthorized access.</rationale>
<ident cce="18095-0" />
<oval id="rsyslog_files_permissions" />
<ref nist="AC-3, CM-6" />
</Rule>
</Group>

<Group id="rsyslog_sending_messages">
<title>Rsyslog Logs Sent To Remote Host</title>
<description>Edit <tt>/etc/rsyslog.conf</tt>. Add or correct the line:
<pre>*.* @loghost.example.com</pre>
where <tt>loghost.example.com</tt> is the name of your central log server.
<br /><br />
If system logs are to be useful in detecting malicious
activities, it is necessary to send logs to a remote server. An
intruder who has compromised the root account on a machine may
delete the log entries which indicate that the system was attacked
before they are seen by an administrator.
<br /><br />
However, it is recommended that logs be stored on the local
host in addition to being sent to the loghost, especially if
<tt>rsyslog</tt> has been configured to use the UDP protocol to send
messages over a network. UDP does not guarantee reliable delivery,
and moderately busy sites will lose log messages occasionally,
especially in periods of high traffic which may be the result of an
attack. In addition, remote <tt>rsyslog</tt> messages are not
authenticated in any way by default, so it is easy for an attacker to
introduce spurious messages to the central log server. Also, some
problems cause loss of network connectivity, which will prevent the
sending of messages to the central server. For all of these reasons, it is
better to store log messages both centrally and on each host, so
that they can be correlated if necessary.</description>

<Rule id="rsyslog_send_messages_to_logserver">
<title>Rsyslog Logs Sent To Remote Host</title>
<description>Rsyslog logs should be sent to a remote loghost or not
as appropriate</description>
<rationale>Forwarding log messages to a remote loghost gives a system administrator a
centralized place to view the status of hosts within the enterprise. The forwarded
messages also serve as a backup of sorts should a compromise be dectected. Should a
compromise occur, the backup log entries could be used to check the host's logs for
consistency.</rationale>
<ident cce="17248-6" />
<oval id="rsyslog_remote_loghost" />
<ref nist="AU-2, AU-9" />
</Rule>
</Group>

<Group id="rsyslog_accepting_remote_messages">
<title>Configure <tt>rsyslogd</tt> to Accept Remote Messages Only As Needed</title>
<description>
By default, RHEL6's <tt>rsyslog</tt> does not listen over the network
for log messages. If needed, the modules <tt>imtcp.so</tt> and <tt>imudp.so</tt>
(and others) enable the daemon to receive messages from other systems and for the system
thus to act as a log server.
If the machine is not a log server, then lines concerning these modules
should remain commented out.
<br /><br />
</description>

<!--<description>Is this machine the central log server for your
organization? If so, edit the file <tt>/etc/sysconfig/rsyslog</tt>. Add
or correct the following line:
<pre>SYSLOGD_OPTIONS="-m 0 -r -s example.com "</pre>
where <tt>example.com</tt> is the name of your domain.
<br /><br />
If the machine is not a log server, edit <tt>/etc/sysconfig/syslog</tt>,
and instead add or correct the line:
<pre>SYSLOGD_OPTIONS="-m 0"</pre>
By default, RHEL6's <tt>rsyslog</tt> does not listen over the network
for log messages. The <tt>-r</tt> flag enables <tt>rsyslogd</tt> to listen over a
network, and should be used only if necessary. The <tt>-s example.com</tt>
flag strips the domain name <tt>example.com</tt> from each sending machine's
hostname before logging messages from that host, to reduce the
amount of redundant information placed in log files. See the
<tt>rsyslogd(8)</tt> man page for further information.</description>
-->

<Rule id="rsyslog_accept_remote_messages_none">
<title>Ensure rsyslog Does Not Accept Remote Messages Unless Acting As Log Server</title>
<description>The <tt>rsyslog</tt> daemon should not accept remote messages
unless the system acts as a log server.
<br/>
TODO: See how /etc/sysconfig/rsyslog plays or interferes or overwrites here.
<br/>
To ensure that it is not listening on the network, ensure the following lines are
<i>not</i> found in <tt>/etc/rsyslog.conf</tt>:
<pre>$ModLoad imtcp.so
$InputTCPServerRun <i>port</i>
$ModLoad imudp.so
$InputUDPServerRun <i>port</i>
$ModLoad imrelp.so
$InputRELPServerRun <i>port</i></pre>
</description>
<rationale>
Any process which receives messages from the network incurs some risk
of receiving malicious messages. This risk can be eliminated for
rsyslog by configuring it not to listen on the network.
</rationale>
<ident cce="17639-6" />
<oval id="rsyslog_nolisten" />
<ref nist="AU-2, AU-9" />
</Rule>

<Rule id="rsyslog_accept_remote_messages_tcp">
<title>Enable rsyslog to Accept Messages via TCP, if Acting As Log Server</title>
<description>The <tt>rsyslog</tt> daemon should not accept remote messages
unless the system acts as a log server.
<br/>
TODO: See how /etc/sysconfig/rsyslog plays or interferes or overwrites here.
<br/>
If the system needs to act as a central log server, add the following lines to
<tt>/etc/rsyslog.conf</tt> to enable reception of messages over TCP:
<pre>$ModLoad imtcp.so
$InputTCPServerRun 514</pre>
</description>
<rationale>
If the system needs to act as a log server, this ensures that it can receive
messages over a reliable TCP connection.
</rationale>
<ident cce="TODO" />
<!--<oval id="rsyslog_listen_tcp" />-->
<ref nist="AU-2, AU-9" />
</Rule>


<Rule id="rsyslog_accept_remote_messages_udp">
<title>Enable rsyslog to Accept Messages via UDP, if Acting As Log Server</title>
<description>
If the system needs to act as a central log server, and it also must receive
messages from systems which can only send them in the traditional UDP
format, then ensure the following lines exist in <tt>/etc/syslog.conf</tt>:
<pre>$ModLoad imudp.so
$InputUDPServerRun 514</pre>
</description>
<rationale>
Many devices, such as switches, routers, and other Unix-like systems, may only support
the traditional syslog transmission over UDP. If the system must act as a log server,
this enables it to receive their messages as well.
</rationale>
<ident cce="TODO" />
<!--<oval id="rsyslog_listen_udp" />-->
<ref nist="AU-2, AU-9" />
</Rule>

</Group>

<Group id="log_rotation">
<title>Ensure All Logs are Rotated by <tt>logrotate</tt></title>
<description>Edit the file <tt>/etc/logrotate.d/syslog</tt>. Find the first
line, which should look like this (wrapped for clarity):
<pre>/var/log/messages /var/log/secure /var/log/maillog /var/log/spooler \
  /var/log/boot.log /var/log/cron {</pre>
Edit this line so that it contains a one-space-separated
listing of each log file referenced in <tt>/etc/rsyslog.conf</tt>.
<br /><br />
All logs in use on a system must be rotated regularly, or the
log files will consume disk space over time, eventually interfering
with system operation. The file <tt>/etc/logrotate.d/syslog</tt> is the
configuration file used by the <tt>logrotate</tt> program to maintain all
log files written by <tt>syslog</tt>. By default, it rotates logs weekly and
stores four archival copies of each log. These settings can be
modified by editing <tt>/etc/logrotate.conf</tt>, but the defaults are
sufficient for purposes of this guide.
<br /><br />
Note that <tt>logrotate</tt> is run nightly by the cron job
<tt>/etc/cron.daily/logrotate</tt>. If particularly active logs need to be
rotated more often than once a day, some other mechanism must be
used.</description>

<Rule id="ensure_logrotate_activated">
<title>Ensure Logs Are Rotated</title>
<description>The <tt>logrotate</tt> (<tt>rsyslog</tt> rotater) service should be
enabled.</description>
<rationale>Log files that are not properly rotated run the risk of growing so large
that they fill up the /var/log partition. Valuable logging information could be lost
if the /var/log partition becomes full.</rationale>
<ident cce="4182-2" />
<oval id="logrotate_rotate_all_files" />
<ref nist="AU-2, AU-9, CM-6" />
</Rule>
</Group>

<Group id="configure_logwatch_on_logserver">
<title> Configure Logwatch on the Central Log Server</title>
<description> 
Is this machine the central log server? If so, edit the file <tt>/etc/logwatch/conf/logwatch.conf</tt> as shown below.
</description>

<Rule id="configure_logwatch_hostlimit">
<title>Configure Logwatch HostLimit Line</title>
<description> On a central logserver, you want Logwatch to summarize all syslog entries, including those which did not originate 
on the logserver itself. The <tt>HostLimit</tt> setting tells Logwatch to report on all hosts, not just the one on which it 
is running. 
<pre> HostLimit = no </pre> </description>
<ident cce="4323-2" />
<oval id="logwatch_configured_hostlimit" />
</Rule>

<Rule id="configure_logwatch_splithosts">
<title>Configure Logwatch SplitHosts Line</title>
<description>
If <tt>SplitHosts</tt> is set, Logwatch will separate entries by hostname. This makes the report longer but significantly 
more usable. If it is not set, then Logwatch will not report which host generated a given log entry, and that 
information is almost always necessary
<pre> SplitHosts = yes </pre> </description>
<ident cce="4323-2" />
<oval id="logwatch_configured_splithosts" />
</Rule>

<!--Ensure that <tt>logwatch.pl</tt> is run nightly from <tt>cron</tt>. (This is the default): 
<pre># cd /etc/cron.daily 
# ln -s /usr/share/logwatch/scripts/logwatch.pl 0logwatch 
</pre>
free disk space. Since all log monitoring is being done on the central logserver, the disk space listing will always be 
that of the logserver, regardless of which host is being monitored. This is confusing, so disable that service. Note 
that this does mean that <tt>Logwatch</tt> will not monitor disk usage information. Many workarounds are possible, 
such as running <tt>df</tt> on each host daily via <tt>cron</tt> and sending the output to <tt>syslog</tt> so that it will be reported to 
the logserver.</description> -->

</Group> <!-- <Group id="configure_logwatch_on_logserver"> -->

<Rule id="disable_logwatch_for_logserver">
<title> Disable Logwatch on Clients if a Logserver Exists</title>
<description> 
Does your site have a central logserver which has been configured to report on logs received from all systems? 
If so:
<pre> 
# rm /etc/cron.daily/0logwatch 
</pre>
If no logserver exists, it will be necessary for each machine to run Logwatch individually. Using a central 
logserver provides the security and reliability benefits discussed earlier, and also makes monitoring logs easier 
and less time-intensive for administrators.</description>
<oval id="logwatch_disabled_for_logserver" />
</Rule>
</Group>
